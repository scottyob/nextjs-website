1:HL["/_next/static/media/2aaf0723e720e8b9-s.p.woff2",{"as":"font","type":"font/woff2"}]
2:HL["/_next/static/media/42e58f5a516ebb1b-s.p.woff2",{"as":"font","type":"font/woff2"}]
3:HL["/_next/static/media/4e8dfc5aa8742fdc-s.p.woff2",{"as":"font","type":"font/woff2"}]
4:HL["/_next/static/css/9cf8a63f1413a643.css",{"as":"style"}]
0:["7ZsjOjk7vyBr-W6eVExxr",[[["",{"children":["(margined)",{"children":["post",{"children":[["slug","2014/ios-vlan","c"],{"children":["__PAGE__?{\"slug\":[\"2014\",\"ios-vlan\"]}",{}]}]}]}]},"$undefined","$undefined",true],"$L5",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/9cf8a63f1413a643.css","precedence":"next"}]],["$L6",["$","meta",null,{"name":"next-size-adjust"}]]]]]]
7:HL["/_next/static/media/8679c800f1e60000-s.p.woff2",{"as":"font","type":"font/woff2"}]
8:HL["/_next/static/media/af1939b13935fec8-s.p.woff2",{"as":"font","type":"font/woff2"}]
9:HL["/_next/static/css/ca688fc28ed2292f.css",{"as":"style"}]
a:I{"id":"7477","chunks":["477:static/chunks/477-c7daa421fa7a3179.js","153:static/chunks/153-afb6e58fe5b824a3.js","651:static/chunks/651-daa55fd5fca8dd15.js","534:static/chunks/app/flying/location/[slug]/page-4cc2569618afec26.js"],"name":"","async":false}
b:I{"id":"5212","chunks":["441:static/chunks/6ab6b39f-5862ad6215660707.js","415:static/chunks/13f37dd2-476cadb300de5e22.js","477:static/chunks/477-c7daa421fa7a3179.js","185:static/chunks/app/layout-da87e8b3bb1e5a13.js"],"name":"","async":false}
c:I{"id":"3211","chunks":["272:static/chunks/webpack-3fab3f8da21db0b3.js","253:static/chunks/bce60fc1-49d8db9e76bd7aad.js","769:static/chunks/769-5ac25c363c83f0e9.js"],"name":"","async":false}
d:I{"id":"5767","chunks":["272:static/chunks/webpack-3fab3f8da21db0b3.js","253:static/chunks/bce60fc1-49d8db9e76bd7aad.js","769:static/chunks/769-5ac25c363c83f0e9.js"],"name":"","async":false}
5:[["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__className_0ec1f4","children":["$","div",null,{"className":"flex max-w-full w-full flex-col pt-8 pb-8","children":[["$","div",null,{"className":"self-center w-full","children":[["$","h1",null,{"className":"text-center text-4xl __className_baad2a","children":["$","$La",null,{"href":"/","children":"Scott O'Brien"}]}],["$","$Lb",null,{}]]}],["$","div",null,{"className":"w-full flex flex-col","id":"main-content","children":["$","$Lc",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Ld",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":[["$","div",null,{"className":"self-center mt-7 max-w-2xl w-[80%]","children":["$","$Lc",null,{"parallelRouterKey":"children","segmentPath":["children","(margined)","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Ld",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$Lc",null,{"parallelRouterKey":"children","segmentPath":["children","(margined)","children","post","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Ld",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$Lc",null,{"parallelRouterKey":"children","segmentPath":["children","(margined)","children","post","children",["slug","2014/ios-vlan","c"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Ld",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$Le",null],"segment":"__PAGE__?{\"slug\":[\"2014\",\"ios-vlan\"]}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/ca688fc28ed2292f.css","precedence":"next"}]]}],"segment":["slug","2014/ios-vlan","c"]},"styles":[]}],"segment":"post"},"styles":[]}]}],null],"segment":"(margined)"},"styles":[]}]}]]}]}]}],null]
6:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Scott O'Brien"}],["$","meta","2",{"name":"description","content":"My online creative outlet"}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}]]
f:I{"id":"9114","chunks":["962:static/chunks/962-5d2ec05cb78683f7.js","726:static/chunks/app/(margined)/post/[...slug]/page-27a51a9e5f925a55.js"],"name":"","async":false}
10:I{"id":"5962","chunks":["962:static/chunks/962-5d2ec05cb78683f7.js","417:static/chunks/app/(margined)/recipes/[slug]/page-f4439429f33b41e2.js"],"name":"","async":false}
11:I{"id":"5470","chunks":["459:static/chunks/459-f53d31367150124c.js","91:static/chunks/app/flying/flight/[slug]/page-cf89954d3ec76a95.js"],"name":"","async":false}
e:["$","article",null,{"className":"","children":["$","div",null,{"className":"__className_f44734 mb-9","children":[["$","h2",null,{"className":"__className_59b087 text-2xl","children":"Automating VLAN changes for ESXi Switchports in Cisco IOS."}],["$","div",null,{"className":"text-xs text-gray-400 italic mb-5","children":["Created: ",["$","$Lf",null,{"date":"$D2014-01-29T10:51:35.000Z"}]]}],["$","$L10",null,{"src":{"src":"/_next/static/media/product_bulletin_cisco_catalyst_6509_enhanced_vertical_chassis-1.07e57352.jpg","height":302,"width":242,"blurDataURL":"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAAIAAYDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAhEAABAwEJAAAAAAAAAAAAAAABAAIDBgQFERMhMTNBkf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwClpNpnr2+xKbUQ3MAEheG8g2x086REQf/Z","blurWidth":6,"blurHeight":8},"alt":"Post picture","className":"m-auto mb-5"}],["$","div",null,{"className":"prose lg:prose-lg","children":["$","$L11",null,{"code":"var Component=(()=>{var u=Object.create;var i=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var l=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var w=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),g=(e,n)=>{for(var o in n)i(e,o,{get:n[o],enumerable:!0})},a=(e,n,o,r)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let s of l(n))!f.call(e,s)&&s!==o&&i(e,s,{get:()=>n[s],enumerable:!(r=d(n,s))||r.enumerable});return e};var y=(e,n,o)=>(o=e!=null?u(m(e)):{},a(n||!e||!e.__esModule?i(o,\"default\",{value:e,enumerable:!0}):o,e)),x=e=>a(i({},\"__esModule\",{value:!0}),e);var h=w((k,c)=>{c.exports=_jsx_runtime});var C={};g(C,{default:()=>v,frontmatter:()=>S});var t=y(h()),S={title:\"Automating VLAN changes for ESXi Switchports in Cisco IOS.\",author:\"scottyob\",type:\"post\",date:new Date(1390992695e3),url:\"/2014/01/29/automating-vlan-changes-for-esxi-switchports-in-cisco-ios/\",categories:[\"Uncategorized\"],hero:\"product_bulletin_cisco_catalyst_6509_enhanced_vertical_chassis-1.jpg\"};function p(e){let n=Object.assign({p:\"p\",a:\"a\",pre:\"pre\",code:\"code\"},e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:[\"At the organisation I'm currently working for, we recently experienced \",(0,t.jsx)(n.a,{href:\"http://www.vspecialist.co.uk/do-my-esxi-hosts-have-the-same-vlans/\",children:\"what appears to be a common issue\"}),\", VLAN's trunked down to ESXi nodes were inconsistent.\"]}),`\n`,(0,t.jsxs)(n.p,{children:[\"In our DC, we're still running the old school Cisco Catalyst switches. \\xA0If we were running a fabric, or Nexus switches \",(0,t.jsx)(n.a,{href:\"http://blog.alwaysthenetwork.com/tutorials/nexus-port-profiles/\",children:\"we could put port profiles\\xA0to action\"}),\"\\xA0or if we lucky enough to have some equipment running Junos \\u2764\\uFE0F  we could be \",(0,t.jsx)(n.a,{href:\"http://packetpushers.net/junos-configuration-groups/\",children:\"using apply-groups for this\"}),\".\"]}),`\n`,`\n`,(0,t.jsx)(n.p,{children:\"Being stuck with 6500's in the DC as our L2 platform (and a VSS for the L3 MPLS PE) this is a quick little hack job to automate configuration changes across switchports in Cisco IOS based on dynamically finding ports that are matching an interface description.\"}),`\n`,(0,t.jsx)(n.p,{children:\"In our DC, we have a bunch of switches (defined at the top of this script) and all our switchports that go to ESXi switchports that should have this template applied are matched on the interface description containing \\u2018ESXHOST'\"}),`\n`,(0,t.jsxs)(n.p,{children:[\"This relies on the \",(0,t.jsx)(n.a,{href:\"https://github.com/knipknap/exscript/wiki/Python-API-Tutorial\",children:\"python EXScript module\"})]}),`\n`,(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:\"language-python\",children:`# This script is used for updating the VLANs that are trunked down to ESX boxes.\n#  It works by logging in to each switch in the DC then looking at the interfaces that have 'ESXHOST'\n#  in the description.  For each of those switchports, it will run the 'alter' commands\n\nfrom Exscript.Account import Account\nfrom Exscript.protocols import SSH2\nimport argparse\nimport getopt\nimport getpass\nimport sys\n\n#A list of the switches to interigate.  These are the switches that have ESXi hosts in them\nSWITCHES = [\n    '10.0.0.2',\n    '10.0.0.3',\n    '10.0.0.4',\n    '10.0.0.5',\n    '10.0.0.7'\n    ]\n\n#Commands to execute for every switchport\nvlan_commands = \"\"\"\n  switchport trunk allowed vlan add 5,10,15,20-25,30,40,50\n  switchport trunk allowed vlan add 60,69,70,100-1000\n\"\"\"\n\ndef query_yes_no(question, default=\"yes\"):\n    \"\"\"Ask a yes/no question via raw_input() and return their answer.\n\n    \"question\" is a string that is presented to the user.\n    \"default\" is the presumed answer if the user just hits &lt;Enter&gt;.\n        It must be \"yes\" (the default), \"no\" or None (meaning\n        an answer is required of the user).\n\n    The \"answer\" return value is one of \"yes\" or \"no\".\n    \"\"\"\n    valid = {\"yes\":True,   \"y\":True,  \"ye\":True,\n             \"no\":False,     \"n\":False}\n    if default == None:\n        prompt = \" [y/n] \"\n    elif default == \"yes\":\n        prompt = \" [Y/n] \"\n    elif default == \"no\":\n        prompt = \" [y/N] \"\n    else:\n        raise ValueError(\"invalid default answer: '%s'\" % default)\n\n    while True:\n        sys.stdout.write(question + prompt)\n        choice = raw_input().lower()\n        if default is not None and choice == '':\n            return valid[default]\n        elif choice in valid:\n            return valid[choice]\n        else:\n            sys.stdout.write(\"Please respond with 'yes' or 'no' \"\\\\\n                             \"(or 'y' or 'n').\\\\n\")\n\ndef returnInterfacesFromShowDescription(text):\n    \"\"\"\n    Returns a LIST of interfaces from the output of 'show interface desc' from a cisco device\n    \"\"\"\n    return [ x.split()[0] for x in text.split(\"\\\\n\") ]\n\ndef genUpdateConfigForInterfaces(config, interfaces):\n    \"\"\"\n    Takes in a configuration block to run, a list of interfaces and generates the appropriate int range commands with the\n    config block after\n    \"\"\"\n    updateConfig = \"\"\n    while len(interfaces) &gt; 0:\n        updateConfig += \"int range \" + \",\".join(interfaces[:5])\n        interfaces = interfaces[5:]\n        updateConfig += \"\\\\n  %s\\\\n\" % config.strip()\n    return updateConfig\n\ndef updateSwitchportsWithDescription(switch, description, username, password, commands):\n    \"\"\"\n    Function is used to log into a switch, find all switchports that CONTAINS the description\n    with each of the said switchports, it will then execute the given commands.\n\n    switch:  Device to log into\n    description:  Search string to try and find in the switchport description\n    username:  Username to log into the switch with\n    password:  The password to log into the switch with\n    commands:  A list of commands that should be executed\n    \"\"\"\n\n    print \"Working with switch: %s\" % switch\n\n    #establish a SSH connection to the host\n    conn = SSH2()\n    account = Account(username, password)\n    conn.connect(switch)\n    conn.login(account)\n\n    #Do some pre-setup\n    conn.execute('')\n\n    #Make sure we're in super user mode\n    conn.execute('enable')\n    conn.execute('terminal length 0')\n\n    #find all ports that have ESXHOST (or whatever is set in description) in the description\n    conn.execute('show int desc | i %s' % description)\n    ports = conn.response.strip()\n\n    print \"Ports are:\"\n    print ports\n    portsList = returnInterfacesFromShowDescription(ports)[1:-1]\n\n    #go into config mode and get ready to run the update commands\n    #Generate a list of the update commands that should be ran\n    updateCommands = genUpdateConfigForInterfaces(commands, portsList).split(\"\\\\n\")\n    conn.execute('conf t')\n    print conn.response.strip()\n    print \"! About to execute the following commands.\"\n    for line in updateCommands:\n        print \"! \" + line\n\n    if query_yes_no('Execute Commands?', default=\"no\"):\n        #Run the set of commands given\n        for command in updateCommands:\n            conn.execute(command)\n            print conn.response\n\n        #Exit out of config mode\n        conn.execute(\"exit\")\n        conn.execute(\"exit\")\n        print conn.response\n        print\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser(description=\"DC ESX VLAN Utility\")\n    parser.add_argument('--user', help='The username that should be used to log into the switches with')\n\n    args = parser.parse_args()\n    if args.user:\n        username = args.user\n    else:\n        username = getpass.getuser()\n\n    password = getpass.getpass()\n\n    # Generate a list of commands\n    for switch in SWITCHES:\n        updateSwitchportsWithDescription(switch, 'ESXHOST', username, password, vlan_commands)\n\n`})})]})}function _(e={}){let{wrapper:n}=e.components||{};return n?(0,t.jsx)(n,Object.assign({},e,{children:(0,t.jsx)(p,e)})):p(e)}var v=_;return x(C);})();\n;return Component;"}]}]]}]}]
