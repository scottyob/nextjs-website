<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="preload" as="font" href="/_next/static/media/2aaf0723e720e8b9-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/42e58f5a516ebb1b-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/4e8dfc5aa8742fdc-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/4c1c321c249fa2d1-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/8679c800f1e60000-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/0d26c7c4f71e78d1.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/99e3bcfff854f17e.css" data-precedence="next"/><title>Scott O&#x27;Brien</title><meta name="description" content="My online creative outlet"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_0ec1f4"><div class="flex max-w-full w-full flex-col pt-8 pb-8"><div class="self-center w-full"><h1 class="text-center text-4xl __className_baad2a"><a href="/">Scott O&#x27;Brien</a></h1><ul class="flex flex-wrap justify-center space-x-2 text-gray-400 italic pt-3 mb-8 max-w-2xl w-[80%] m-auto __className_6cf34a"><li class="transition group duration-300 whitespace-nowrap"><a href="/">Writings/Projects</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-[70%] bg-orange-500"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/about/">About</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/bucketlist/">Bucket List</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/recipes/">Cooking</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/flying/">Flying</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li></ul></div><div class="w-full flex flex-col" id="main-content"><div class="self-center mt-7 max-w-2xl w-[80%]"><article class=""><div class="__className_2e19ce mb-9"><h2 class="__className_59b087 text-2xl">ESPChess NewGame Bug</h2><div class="text-xs text-gray-400 italic mb-5">Created: <span>4/5/2022, 12:00:00 AM</span></div><img alt="Post picture" loading="lazy" width="308" height="237" decoding="async" data-nimg="1" class="m-auto mb-5" style="color:transparent" src="/_next/static/media/logo.a7af3173.png"/><div class="prose lg:prose-lg"><p>Ordering is a little off here, but I wanted to writeup about a bug I&#x27;m seeing in the ESPChess project (post to come) and how I intend to fix it.</p>
<!-- -->
<p>The chessboard uses AWS IoT Shadow Service (MQTT accessed key-value store) to keep track of your and your opponents chess board state.  It has a sequence number that&#x27;s incremeneted to flag when we should update our current state to match our opponents.</p>
<p>Once a game is finished, it shows who won the game.  Once all the pieces are back in their starting position, it attempts to restart the game, and flip the black and white players around.  The problem is, when testing this out with my father, that it&#x27;s not all that user friendly, and it&#x27;s a bit finicky.  When a game is finished, the colors show the delta with the old game, and not a new game.  I think the new logic should be:</p>
<ul>
<li>We store lastGameState</li>
<li>We store lastGamePreviousMoveState</li>
<li>If the sequence number is 0, and the current board state matches the lastGameState or lastGamePreviousMoveState, then show the winner or delta, otherwise show the delta with the current (presumably new game) board state.</li>
<li>When a board finishes the game, it should update the lastGameState, lastGamePreviousMoveState to the current winning move state.  gameState and gamePreviousMoveState should be reset to a new starting position.</li>
<li>In the event of the opponents sequence number being 0, and ours not, update our state to match our opponents (with the isWhite value flipped)</li>
</ul></div></div></article></div></div></div><script src="/_next/static/chunks/webpack-caf0f53964771028.js" async=""></script><script src="/_next/static/chunks/bce60fc1-e7cb3874f5f47943.js" async=""></script><script src="/_next/static/chunks/488-f907c6837e991d02.js" async=""></script><script src="/_next/static/chunks/main-app-fd28149d965ecf3e.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/2aaf0723e720e8b9-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/42e58f5a516ebb1b-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/media/4e8dfc5aa8742fdc-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/0d26c7c4f71e78d1.css\",{\"as\":\"style\"}]\n0:\"$L5\"\n"])</script><script>self.__next_f.push([1,"6:HL[\"/_next/static/media/4c1c321c249fa2d1-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n7:HL[\"/_next/static/media/8679c800f1e60000-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n8:HL[\"/_next/static/css/99e3bcfff854f17e.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"9:I{\"id\":\"8827\",\"chunks\":[\"272:static/chunks/webpack-caf0f53964771028.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"488:static/chunks/488-f907c6837e991d02.js\"],\"name\":\"\",\"async\":false}\nb:I{\"id\":\"9126\",\"chunks\":[\"272:static/chunks/webpack-caf0f53964771028.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"488:static/chunks/488-f907c6837e991d02.js\"],\"name\":\"\",\"async\":false}\nc:I{\"id\":\"8920\",\"chunks\":[\"920:static/chunks/920-beeca0bfb1d2369e.js\",\"550:static/chunks/550-ecfe52e7b59667b2.js\",\"534:static/"])</script><script>self.__next_f.push([1,"chunks/app/flying/location/[slug]/page-043b33a402eae0f5.js\"],\"name\":\"\",\"async\":false}\nd:I{\"id\":\"558\",\"chunks\":[\"920:static/chunks/920-beeca0bfb1d2369e.js\",\"185:static/chunks/app/layout-33994cd5ee6d865f.js\"],\"name\":\"\",\"async\":false}\nf:I{\"id\":\"4463\",\"chunks\":[\"272:static/chunks/webpack-caf0f53964771028.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"488:static/chunks/488-f907c6837e991d02.js\"],\"name\":\"\",\"async\":false}\n10:I{\"id\":\"1010\",\"chunks\":[\"272:static/chunks/webpack-caf0f53964771028.js\",\"253:static/"])</script><script>self.__next_f.push([1,"chunks/bce60fc1-e7cb3874f5f47943.js\",\"488:static/chunks/488-f907c6837e991d02.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"5:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0d26c7c4f71e78d1.css\",\"precedence\":\"next\"}]],[\"$\",\"$L9\",null,{\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/post/2022-04-05-chess-bug/\",\"initialTree\":[\"\",{\"children\":[\"(margined)\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"2022-04-05-chess-bug\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"2022-04-05-chess-bug\\\"]}\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[\"$La\",[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]],\"globalErrorComponent\":\"$b\",\"notFound\":[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_0ec1f4\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex max-w-full w-full flex-col pt-8 pb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"self-center w-full\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-center text-4xl __className_baad2a\",\"children\":[\"$\",\"$Lc\",null,{\"href\":\"/\",\"children\":\"Scott O'Brien\"}]}],[\"$\",\"$Ld\",null,{}]]}],[\"$\",\"div\",null,{\"className\":\"w-full flex flex-col\",\"id\":\"main-content\",\"children\":[\"$Le\",\"$undefined\",[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]]}]]}]}]}],\"asNotFound\":false,\"children\":[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_0ec1f4\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex max-w-full w-full flex-col pt-8 pb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"self-center w-full\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-center text-4xl __className_baad2a\",\"children\":[\"$\",\"$Lc\",null,{\"href\":\"/\",\"children\":\"Scott O'Brien\"}]}],[\"$\",\"$Ld\",null,{}]]}],[\"$\",\"div\",null,{\"className\":\"w-full flex flex-col\",\"id\":\"main-content\",\"children\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[[\"$\",\"div\",null,{\"className\":\"self-center mt-7 max-w-2xl w-[80%]\",\"children\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(margined)\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(margined)\",\"children\",\"post\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(margined)\",\"children\",\"post\",\"children\",[\"slug\",\"2022-04-05-chess-bug\",\"c\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$L11\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":[\\\"2022-04-05-chess-bug\\\"]}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/99e3bcfff854f17e.css\",\"precedence\":\"next\"}]]}],\"segment\":[\"slug\",\"2022-04-05-chess-bug\",\"c\"]},\"styles\":[]}],\"segment\":\"post\"},\"styles\":[]}]}],null],\"segment\":\"(margined)\"},\"styles\":[]}]}]]}]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\na:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Scott O'Brien\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"My online creative outlet\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"any\"}]]\n"])</script><script>self.__next_f.push([1,"12:I{\"id\":\"8288\",\"chunks\":[\"707:static/chunks/707-e3070078e72f1aa2.js\",\"726:static/chunks/app/(margined)/post/[...slug]/page-824ad804da7b0d15.js\"],\"name\":\"\",\"async\":false}\n13:I{\"id\":\"8707\",\"chunks\":[\"707:static/chunks/707-e3070078e72f1aa2.js\",\"114:static/chunks/114-8ea2e93770e365d4.js\",\"857:static/chunks/app/(margined)/bucketlist/page-769f4f65ec86f612.js\"],\"name\":\"\",\"async\":false}\n14:I{\"id\":\"2853\",\"chunks\":[\"91:static/chunks/app/flying/flight/[slug]/page-96287e22abdff0cd.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"11:[\"$\",\"article\",null,{\"className\":\"\",\"children\":[\"$\",\"div\",null,{\"className\":\"__className_2e19ce mb-9\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"__className_59b087 text-2xl\",\"children\":\"ESPChess NewGame Bug\"}],[\"$\",\"div\",null,{\"className\":\"text-xs text-gray-400 italic mb-5\",\"children\":[\"Created: \",[\"$\",\"$L12\",null,{\"date\":\"$D2022-04-05T00:00:00.000Z\"}]]}],[\"$\",\"$L13\",null,{\"src\":{\"src\":\"/_next/static/media/logo.a7af3173.png\",\"height\":237,\"width\":308,\"blurDataURL\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAAG1BMVEXJycnu7u7X19e2trb+/v7AwMDh4eH39/fPz8/OrR5qAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAK0lEQVR4nAXBhwEAMAjDMGdQ+P/iSlQPuYWncLekA+thdmxJpM8JcGjD+AMQqQCZjYN5tQAAAABJRU5ErkJggg==\",\"blurWidth\":8,\"blurHeight\":6},\"alt\":\"Post picture\",\"className\":\"m-auto mb-5\"}],[\"$\",\"div\",null,{\"className\":\"prose lg:prose-lg\",\"children\":[\"$\",\"$L14\",null,{\"code\":\"var Component=(()=\u003e{var d=Object.create;var s=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var w=(t,e)=\u003e()=\u003e(e||t((e={exports:{}}).exports,e),e.exports),b=(t,e)=\u003e{for(var a in e)s(t,a,{get:e[a],enumerable:!0})},r=(t,e,a,i)=\u003e{if(e\u0026\u0026typeof e==\\\"object\\\"||typeof e==\\\"function\\\")for(let o of m(e))!g.call(t,o)\u0026\u0026o!==a\u0026\u0026s(t,o,{get:()=\u003ee[o],enumerable:!(i=u(e,o))||i.enumerable});return t};var f=(t,e,a)=\u003e(a=t!=null?d(p(t)):{},r(e||!t||!t.__esModule?s(a,\\\"default\\\",{value:t,enumerable:!0}):a,t)),v=t=\u003er(s({},\\\"__esModule\\\",{value:!0}),t);var l=w((M,h)=\u003e{h.exports=_jsx_runtime});var j={};b(j,{default:()=\u003ex,frontmatter:()=\u003eS});var n=f(l()),S={title:\\\"ESPChess NewGame Bug\\\",type:\\\"post\\\",author:\\\"scottyob\\\",date:new Date(16491168e5),categories:[\\\"nerd\\\"],tags:[\\\"chess\\\"],hero:\\\"logo.png\\\"};function c(t){let e=Object.assign({p:\\\"p\\\",ul:\\\"ul\\\",li:\\\"li\\\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:\\\"Ordering is a little off here, but I wanted to writeup about a bug I'm seeing in the ESPChess project (post to come) and how I intend to fix it.\\\"}),`\\n`,`\\n`,(0,n.jsx)(e.p,{children:\\\"The chessboard uses AWS IoT Shadow Service (MQTT accessed key-value store) to keep track of your and your opponents chess board state.  It has a sequence number that's incremeneted to flag when we should update our current state to match our opponents.\\\"}),`\\n`,(0,n.jsx)(e.p,{children:\\\"Once a game is finished, it shows who won the game.  Once all the pieces are back in their starting position, it attempts to restart the game, and flip the black and white players around.  The problem is, when testing this out with my father, that it's not all that user friendly, and it's a bit finicky.  When a game is finished, the colors show the delta with the old game, and not a new game.  I think the new logic should be:\\\"}),`\\n`,(0,n.jsxs)(e.ul,{children:[`\\n`,(0,n.jsx)(e.li,{children:\\\"We store lastGameState\\\"}),`\\n`,(0,n.jsx)(e.li,{children:\\\"We store lastGamePreviousMoveState\\\"}),`\\n`,(0,n.jsx)(e.li,{children:\\\"If the sequence number is 0, and the current board state matches the lastGameState or lastGamePreviousMoveState, then show the winner or delta, otherwise show the delta with the current (presumably new game) board state.\\\"}),`\\n`,(0,n.jsx)(e.li,{children:\\\"When a board finishes the game, it should update the lastGameState, lastGamePreviousMoveState to the current winning move state.  gameState and gamePreviousMoveState should be reset to a new starting position.\\\"}),`\\n`,(0,n.jsx)(e.li,{children:\\\"In the event of the opponents sequence number being 0, and ours not, update our state to match our opponents (with the isWhite value flipped)\\\"}),`\\n`]})]})}function y(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(c,t)})):c(t)}var x=y;return v(j);})();\\n;return Component;\"}]}]]}]}]\n"])</script></body></html>