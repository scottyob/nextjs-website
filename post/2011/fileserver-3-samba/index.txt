1:HL["/_next/static/media/2aaf0723e720e8b9-s.p.woff2",{"as":"font","type":"font/woff2"}]
2:HL["/_next/static/media/42e58f5a516ebb1b-s.p.woff2",{"as":"font","type":"font/woff2"}]
3:HL["/_next/static/media/4e8dfc5aa8742fdc-s.p.woff2",{"as":"font","type":"font/woff2"}]
4:HL["/_next/static/css/9cf8a63f1413a643.css",{"as":"style"}]
0:["uOt5FbJRqbg5lLekjZWYV",[[["",{"children":["(margined)",{"children":["post",{"children":[["slug","2011/fileserver-3-samba","c"],{"children":["__PAGE__?{\"slug\":[\"2011\",\"fileserver-3-samba\"]}",{}]}]}]}]},"$undefined","$undefined",true],"$L5",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/9cf8a63f1413a643.css","precedence":"next"}]],["$L6",["$","meta",null,{"name":"next-size-adjust"}]]]]]]
7:HL["/_next/static/media/8679c800f1e60000-s.p.woff2",{"as":"font","type":"font/woff2"}]
8:HL["/_next/static/media/af1939b13935fec8-s.p.woff2",{"as":"font","type":"font/woff2"}]
9:HL["/_next/static/css/ca688fc28ed2292f.css",{"as":"style"}]
a:I{"id":"7477","chunks":["477:static/chunks/477-c7daa421fa7a3179.js","153:static/chunks/153-afb6e58fe5b824a3.js","651:static/chunks/651-daa55fd5fca8dd15.js","534:static/chunks/app/flying/location/[slug]/page-4cc2569618afec26.js"],"name":"","async":false}
b:I{"id":"5212","chunks":["441:static/chunks/6ab6b39f-5862ad6215660707.js","415:static/chunks/13f37dd2-476cadb300de5e22.js","477:static/chunks/477-c7daa421fa7a3179.js","185:static/chunks/app/layout-da87e8b3bb1e5a13.js"],"name":"","async":false}
c:I{"id":"3211","chunks":["272:static/chunks/webpack-3fab3f8da21db0b3.js","253:static/chunks/bce60fc1-49d8db9e76bd7aad.js","769:static/chunks/769-5ac25c363c83f0e9.js"],"name":"","async":false}
d:I{"id":"5767","chunks":["272:static/chunks/webpack-3fab3f8da21db0b3.js","253:static/chunks/bce60fc1-49d8db9e76bd7aad.js","769:static/chunks/769-5ac25c363c83f0e9.js"],"name":"","async":false}
5:[["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__className_0ec1f4","children":["$","div",null,{"className":"flex max-w-full w-full flex-col pt-8 pb-8","children":[["$","div",null,{"className":"self-center w-full","children":[["$","h1",null,{"className":"text-center text-4xl __className_baad2a","children":["$","$La",null,{"href":"/","children":"Scott O'Brien"}]}],["$","$Lb",null,{}]]}],["$","div",null,{"className":"w-full flex flex-col","id":"main-content","children":["$","$Lc",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Ld",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":[["$","div",null,{"className":"self-center mt-7 max-w-2xl w-[80%]","children":["$","$Lc",null,{"parallelRouterKey":"children","segmentPath":["children","(margined)","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Ld",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$Lc",null,{"parallelRouterKey":"children","segmentPath":["children","(margined)","children","post","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Ld",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$Lc",null,{"parallelRouterKey":"children","segmentPath":["children","(margined)","children","post","children",["slug","2011/fileserver-3-samba","c"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Ld",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$Le",null],"segment":"__PAGE__?{\"slug\":[\"2011\",\"fileserver-3-samba\"]}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/ca688fc28ed2292f.css","precedence":"next"}]]}],"segment":["slug","2011/fileserver-3-samba","c"]},"styles":[]}],"segment":"post"},"styles":[]}]}],null],"segment":"(margined)"},"styles":[]}]}]]}]}]}],null]
6:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Scott O'Brien"}],["$","meta","2",{"name":"description","content":"My online creative outlet"}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}]]
f:I{"id":"9114","chunks":["962:static/chunks/962-5d2ec05cb78683f7.js","726:static/chunks/app/(margined)/post/[...slug]/page-27a51a9e5f925a55.js"],"name":"","async":false}
10:I{"id":"5470","chunks":["459:static/chunks/459-f53d31367150124c.js","91:static/chunks/app/flying/flight/[slug]/page-cf89954d3ec76a95.js"],"name":"","async":false}
e:["$","article",null,{"className":"","children":["$","div",null,{"className":"__className_f44734 mb-9","children":[["$","h2",null,{"className":"__className_59b087 text-2xl","children":"Allowing access through NFS & SAMBA"}],["$","div",null,{"className":"text-xs text-gray-400 italic mb-5","children":["Created: ",["$","$Lf",null,{"date":"$D2011-04-04T11:53:32.000Z"}]]}],"$undefined",["$","div",null,{"className":"prose lg:prose-lg","children":["$","$L10",null,{"code":"var Component=(()=>{var h=Object.create;var p=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var w=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var k=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),u=(n,e)=>{for(var o in e)p(n,o,{get:e[o],enumerable:!0})},r=(n,e,o,a)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let s of d(e))!B.call(n,s)&&s!==o&&p(n,s,{get:()=>e[s],enumerable:!(a=_(e,s))||a.enumerable});return n};var g=(n,e,o)=>(o=n!=null?h(w(n)):{},r(e||!n||!n.__esModule?p(o,\"default\",{value:n,enumerable:!0}):o,n)),y=n=>r(p({},\"__esModule\",{value:!0}),n);var l=k((L,m)=>{m.exports=_jsx_runtime});var v={};u(v,{default:()=>x,frontmatter:()=>N});var t=g(l());var i=\"/posts/2011/fileserver-3-samba/image1-PCFS2IXR.png\";var N={title:\"Allowing access through NFS & SAMBA\",author:\"scottyob\",type:\"post\",date:new Date(1301918012e3),url:\"/2011/04/04/allowing-access-through-nfs-samba/\",categories:[\"FileServer\",\"nerd\"],tags:[\"CIFS\",\"NFS\",\"ZFS\"],hero:\"image1.png\",hideHero:!0};function c(n){let e=Object.assign({p:\"p\",h3:\"h3\",pre:\"pre\",code:\"code\",strong:\"strong\",ol:\"ol\",li:\"li\"},n.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.p,{children:\"This is in the series of setting up a fileserver.  We go through the process of setting up NFS & Samba.\"}),`\n`,`\n`,`\n`,(0,t.jsx)(e.h3,{children:\"Cifs Share\"}),`\n`,(0,t.jsx)(e.p,{children:\"CIFS (Common Internet File System), the protocol windows users for all it\\u2019s \\u2018windows file sharing\\u2019 is the method I\\u2019ll allow for my desktops and roaming computers to access files on the file server.\"}),`\n`,(0,t.jsx)(e.p,{children:\"Before we begin, Make sure we install the CIFS kernal modules\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# pkg install SUNWsmbs \n# pkg install SUNWsmbskr\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"next we issue this command to make sure it auto starts\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# svcadm enable -r smb/server\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"I've decided for every day use, I want a data store on the server, so..\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# zfs create datastore/homes \n# zfs create datastore/homes/scott\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"now, set up compression on my home directory\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# zfs set compression=on datastore/homes\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"Time to do some setup so we can log into this share, I'll make the box join the workgroup \\u2018home\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# smbadm join -w home\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"To start sharing with windows boxes, I need to change the pam.conf file to generate windows passwords too. Add the line below /etc/pam.conf\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`\nother password required pam_smb_passwd.so.1 nowarn\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"reset the password for my user scott, then I'll be able to authenticate with him\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# passwd scott\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"The next step is setting up guest access. You may remember we created a media share datastore/media. We want to share that with guests to the network (on the trusted subnet anyway). Before we go ahead and set that up, we want to map the windows Guest user to the unix user nobody.\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# idmap add winname:Guest unixuser:nobody\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"then we'll allow guest access to our media box\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# zfs set sharesmb=name=media,guestok=true datastore/media\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"I also want to make my home directory only accessible by me, so I\\u2019m going to own the directory\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`chown scott /datastore/homes/scott chgrp staff /datastore/homes/scott chmod 700 /datastore/homes/scott\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"and share it\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# zfs set sharesmb=name=scott datastore/homes/scott\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"So there we have it, a media folder anyone can access, and a \\u2018scott\\u2019 share that I\\u2019ll need to authenticate with (HOME\\\\scott user)\"}),`\n`,(0,t.jsx)(\"img\",{src:i}),`\n`,(0,t.jsx)(e.h3,{children:\"NFS Shares\"}),`\n`,(0,t.jsx)(e.p,{children:\"Now we\\u2019ve got CIFS set up for our clients, I want to set up NFS shares for other Linux boxes on the network (at this point, only my router) to be able to access. The idea is that my router will have all the home directories on the FileServer (so it\\u2019ll get the advantages of snapshots, etc) we well as not being limited to the dying 60GB hard disk for torrenting and such things.\"}),`\n`,(0,t.jsx)(e.p,{children:\"As mentioned, I\\u2019m only interested in NFS shares with my router at this point, so we\\u2019ll make sure my routers IP address (10.12.1.254) is restricted in the shares.\"}),`\n`,(0,t.jsx)(e.p,{children:\"The first thing we want to try is setting up the nfs mount on our homes directory.\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# zfs set [sharenfs=root=@10.12.1.254,rw=@10.12.1.254](mailto:sharenfs=root=@10.12.1.254,rw=@10.12.1.254) datastore/homes\n`})}),`\n`,(0,t.jsxs)(e.p,{children:[\"Now, \",(0,t.jsx)(e.strong,{children:\"on my debian router box\"}),\" I want to see if I can mount this (assuming the directory /home2/scott exists on the client)\"]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`sudo mount -t nfs -o nfsvers=3 10.12.1.1:/datastore/homes/scott /home2/scott\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"and Ta-Da! My home directory is mounted. What I want to do now is to set up auto-mounts. That is, when a directory is accessed for my users home directory, it\\u2019d mount it on the fly.\"}),`\n`,(0,t.jsx)(e.p,{children:\"First, install the autofs package\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`apt-get install autofs\n`})}),`\n`,(0,t.jsxs)(e.p,{children:[\"Add the following line into \",(0,t.jsx)(e.strong,{children:\"/etc/auto.master\"})]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`/home2 /etc/auto.home -\\u2013timeout=60\n`})}),`\n`,(0,t.jsxs)(e.p,{children:[\"and the following into the file \",(0,t.jsx)(e.strong,{children:\"/etc/auto.home\"})]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`* -fstype=nfs,rw,nosuid,soft,vers=3 server:/datastore/homes/&\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"the ***** and /datastore/homes/& do their magic by automatically mounting the required directory when needed (as long as the /etc/init.d/autofs is started)\"}),`\n`,(0,t.jsx)(e.p,{children:\"Now lets add a place for our downloads\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# zfs create datastore/media/downloads \n# zfs set sharenfs=root=router,rw=router datastore/media/downloads\n`})}),`\n`,(0,t.jsxs)(e.p,{children:[\"I chose to just mount this using the automounter under the home2 directory, I added this to the \",(0,t.jsx)(e.strong,{children:\"/etc/auto.home\"}),\" file\"]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`downloads -fstype=nfs,rw,nosuid,soft,vers=3 10.12.1.1:/datastore/media/downloads\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"Pretty neat, now when you head to a directory that's not mounted yet (like /home2/scott/) in the linux client, it will auto mount the required NFS volume and presto, we've got ourselves network storage.\"}),`\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:\"Other posts to come in the series:\"})}),`\n`,(0,t.jsxs)(e.ol,{children:[`\n`,(0,t.jsx)(e.li,{children:\"Selecting the hardware\"}),`\n`,(0,t.jsx)(e.li,{children:\"Installing the Operating System\"}),`\n`,(0,t.jsx)(e.li,{children:\"Setting up File systems & Snapshots\"}),`\n`,(0,t.jsx)(e.li,{children:\"Allowing access through NFS & SAMBA\"}),`\n`,(0,t.jsx)(e.li,{children:\"Setting up encrypted off-site backups\"}),`\n`,(0,t.jsx)(e.li,{children:\"Configuring Windows & Linux clients to dump backup info to the FileServer\"}),`\n`,(0,t.jsx)(e.li,{children:\"My router setup, configuring IP tables & torrents on a low-powered server.\"}),`\n`]})]})}function f(n={}){let{wrapper:e}=n.components||{};return e?(0,t.jsx)(e,Object.assign({},n,{children:(0,t.jsx)(c,n)})):c(n)}var x=f;return y(v);})();\n;return Component;"}]}]]}]}]
