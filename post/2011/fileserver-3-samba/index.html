<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="preload" as="font" href="/_next/static/media/2aaf0723e720e8b9-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/42e58f5a516ebb1b-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/4e8dfc5aa8742fdc-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/8679c800f1e60000-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/d2c70a2e5d6bd385-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/0d26c7c4f71e78d1.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/386fa29998ac6a74.css" data-precedence="next"/><title>Scott O&#x27;Brien</title><meta name="description" content="My online creative outlet"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_0ec1f4"><div class="flex max-w-full w-full flex-col pt-8 pb-8"><div class="self-center w-full"><h1 class="text-center text-4xl __className_baad2a"><a href="/">Scott O&#x27;Brien</a></h1><ul class="flex flex-wrap justify-center space-x-2 text-gray-400 italic pt-3 mb-8 max-w-2xl w-[80%] m-auto __className_6cf34a"><li class="transition group duration-300 whitespace-nowrap"><a href="/">Writings/Projects</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-[70%] bg-orange-500"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/about/">About</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/bucketlist/">Bucket List</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/recipes/">Cooking</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/flying/">Flying</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li></ul></div><div class="w-full flex flex-col" id="main-content"><div class="self-center mt-7 max-w-2xl w-[80%]"><article class=""><div class="__className_af3318 mb-9"><h2 class="__className_59b087 text-2xl">Allowing access through NFS &amp; SAMBA</h2><div class="text-xs text-gray-400 italic mb-5">Created: <span>4/4/2011, 11:53:32 AM</span></div><div class="prose lg:prose-lg"><p>This is in the series of setting up a fileserver.  We go through the process of setting up NFS &amp; Samba.</p>
<!-- -->
<!-- -->
<h3>Cifs Share</h3>
<p>CIFS (Common Internet File System), the protocol windows users for all it’s ‘windows file sharing’ is the method I’ll allow for my desktops and roaming computers to access files on the file server.</p>
<p>Before we begin, Make sure we install the CIFS kernal modules</p>
<pre><code># pkg install SUNWsmbs 
# pkg install SUNWsmbskr
</code></pre>
<p>next we issue this command to make sure it auto starts</p>
<pre><code># svcadm enable -r smb/server
</code></pre>
<p>I&#x27;ve decided for every day use, I want a data store on the server, so..</p>
<pre><code># zfs create datastore/homes 
# zfs create datastore/homes/scott
</code></pre>
<p>now, set up compression on my home directory</p>
<pre><code># zfs set compression=on datastore/homes
</code></pre>
<p>Time to do some setup so we can log into this share, I&#x27;ll make the box join the workgroup ‘home</p>
<pre><code># smbadm join -w home
</code></pre>
<p>To start sharing with windows boxes, I need to change the pam.conf file to generate windows passwords too. Add the line below /etc/pam.conf</p>
<pre><code>
other password required pam_smb_passwd.so.1 nowarn
</code></pre>
<p>reset the password for my user scott, then I&#x27;ll be able to authenticate with him</p>
<pre><code># passwd scott
</code></pre>
<p>The next step is setting up guest access. You may remember we created a media share datastore/media. We want to share that with guests to the network (on the trusted subnet anyway). Before we go ahead and set that up, we want to map the windows Guest user to the unix user nobody.</p>
<pre><code># idmap add winname:Guest unixuser:nobody
</code></pre>
<p>then we&#x27;ll allow guest access to our media box</p>
<pre><code># zfs set sharesmb=name=media,guestok=true datastore/media
</code></pre>
<p>I also want to make my home directory only accessible by me, so I’m going to own the directory</p>
<pre><code>chown scott /datastore/homes/scott chgrp staff /datastore/homes/scott chmod 700 /datastore/homes/scott
</code></pre>
<p>and share it</p>
<pre><code># zfs set sharesmb=name=scott datastore/homes/scott
</code></pre>
<p>So there we have it, a media folder anyone can access, and a ‘scott’ share that I’ll need to authenticate with (HOME\scott user)</p>
<img src="/posts/2011/fileserver-3-samba/image1-PCFS2IXR.png"/>
<h3>NFS Shares</h3>
<p>Now we’ve got CIFS set up for our clients, I want to set up NFS shares for other Linux boxes on the network (at this point, only my router) to be able to access. The idea is that my router will have all the home directories on the FileServer (so it’ll get the advantages of snapshots, etc) we well as not being limited to the dying 60GB hard disk for torrenting and such things.</p>
<p>As mentioned, I’m only interested in NFS shares with my router at this point, so we’ll make sure my routers IP address (10.12.1.254) is restricted in the shares.</p>
<p>The first thing we want to try is setting up the nfs mount on our homes directory.</p>
<pre><code># zfs set [sharenfs=root=@10.12.1.254,rw=@10.12.1.254](mailto:sharenfs=root=@10.12.1.254,rw=@10.12.1.254) datastore/homes
</code></pre>
<p>Now, <strong>on my debian router box</strong> I want to see if I can mount this (assuming the directory /home2/scott exists on the client)</p>
<pre><code>sudo mount -t nfs -o nfsvers=3 10.12.1.1:/datastore/homes/scott /home2/scott
</code></pre>
<p>and Ta-Da! My home directory is mounted. What I want to do now is to set up auto-mounts. That is, when a directory is accessed for my users home directory, it’d mount it on the fly.</p>
<p>First, install the autofs package</p>
<pre><code>apt-get install autofs
</code></pre>
<p>Add the following line into <strong>/etc/auto.master</strong></p>
<pre><code>/home2 /etc/auto.home -–timeout=60
</code></pre>
<p>and the following into the file <strong>/etc/auto.home</strong></p>
<pre><code>* -fstype=nfs,rw,nosuid,soft,vers=3 server:/datastore/homes/&amp;
</code></pre>
<p>the ***** and /datastore/homes/&amp; do their magic by automatically mounting the required directory when needed (as long as the /etc/init.d/autofs is started)</p>
<p>Now lets add a place for our downloads</p>
<pre><code># zfs create datastore/media/downloads 
# zfs set sharenfs=root=router,rw=router datastore/media/downloads
</code></pre>
<p>I chose to just mount this using the automounter under the home2 directory, I added this to the <strong>/etc/auto.home</strong> file</p>
<pre><code>downloads -fstype=nfs,rw,nosuid,soft,vers=3 10.12.1.1:/datastore/media/downloads
</code></pre>
<p>Pretty neat, now when you head to a directory that&#x27;s not mounted yet (like /home2/scott/) in the linux client, it will auto mount the required NFS volume and presto, we&#x27;ve got ourselves network storage.</p>
<p><strong>Other posts to come in the series:</strong></p>
<ol>
<li>Selecting the hardware</li>
<li>Installing the Operating System</li>
<li>Setting up File systems &amp; Snapshots</li>
<li>Allowing access through NFS &amp; SAMBA</li>
<li>Setting up encrypted off-site backups</li>
<li>Configuring Windows &amp; Linux clients to dump backup info to the FileServer</li>
<li>My router setup, configuring IP tables &amp; torrents on a low-powered server.</li>
</ol></div></div></article></div></div></div><script src="/_next/static/chunks/webpack-6854f8b189d0947c.js" async=""></script><script src="/_next/static/chunks/bce60fc1-e7cb3874f5f47943.js" async=""></script><script src="/_next/static/chunks/769-64fef319af2abb40.js" async=""></script><script src="/_next/static/chunks/main-app-7c73dbeff8b74fd8.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/2aaf0723e720e8b9-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/42e58f5a516ebb1b-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/media/4e8dfc5aa8742fdc-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/0d26c7c4f71e78d1.css\",{\"as\":\"style\"}]\n0:\"$L5\"\n"])</script><script>self.__next_f.push([1,"6:HL[\"/_next/static/media/8679c800f1e60000-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n7:HL[\"/_next/static/media/d2c70a2e5d6bd385-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n8:HL[\"/_next/static/css/386fa29998ac6a74.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"9:I{\"id\":\"8802\",\"chunks\":[\"272:static/chunks/webpack-6854f8b189d0947c.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"769:static/chunks/769-64fef319af2abb40.js\"],\"name\":\"\",\"async\":false}\nb:I{\"id\":\"4299\",\"chunks\":[\"272:static/chunks/webpack-6854f8b189d0947c.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"769:static/chunks/769-64fef319af2abb40.js\"],\"name\":\"\",\"async\":false}\nc:I{\"id\":\"7477\",\"chunks\":[\"477:static/chunks/477-6554af05b281746c.js\",\"153:static/chunks/153-7f7061897db69601.js\",\"651:static/"])</script><script>self.__next_f.push([1,"chunks/651-05a1ce4efc0860d4.js\",\"534:static/chunks/app/flying/location/[slug]/page-65be048863d8522d.js\"],\"name\":\"\",\"async\":false}\nd:I{\"id\":\"5212\",\"chunks\":[\"477:static/chunks/477-6554af05b281746c.js\",\"185:static/chunks/app/layout-9d8f06291be9ea84.js\"],\"name\":\"\",\"async\":false}\nf:I{\"id\":\"3211\",\"chunks\":[\"272:static/chunks/webpack-6854f8b189d0947c.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"769:static/chunks/769-64fef319af2abb40.js\"],\"name\":\"\",\"async\":false}\n10:I{\"id\":\"5767\",\"chunks\":[\"272:static/chu"])</script><script>self.__next_f.push([1,"nks/webpack-6854f8b189d0947c.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"769:static/chunks/769-64fef319af2abb40.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"5:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0d26c7c4f71e78d1.css\",\"precedence\":\"next\"}]],[\"$\",\"$L9\",null,{\"buildId\":\"nyQ4j_cb2Z01OQbkHVE62\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/post/2011/fileserver-3-samba/\",\"initialTree\":[\"\",{\"children\":[\"(margined)\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"2011/fileserver-3-samba\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"2011\\\",\\\"fileserver-3-samba\\\"]}\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[\"$La\",[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]],\"globalErrorComponent\":\"$b\",\"notFound\":[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_0ec1f4\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex max-w-full w-full flex-col pt-8 pb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"self-center w-full\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-center text-4xl __className_baad2a\",\"children\":[\"$\",\"$Lc\",null,{\"href\":\"/\",\"children\":\"Scott O'Brien\"}]}],[\"$\",\"$Ld\",null,{}]]}],[\"$\",\"div\",null,{\"className\":\"w-full flex flex-col\",\"id\":\"main-content\",\"children\":[\"$Le\",\"$undefined\",[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]]}]]}]}]}],\"asNotFound\":false,\"children\":[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_0ec1f4\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex max-w-full w-full flex-col pt-8 pb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"self-center w-full\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-center text-4xl __className_baad2a\",\"children\":[\"$\",\"$Lc\",null,{\"href\":\"/\",\"children\":\"Scott O'Brien\"}]}],[\"$\",\"$Ld\",null,{}]]}],[\"$\",\"div\",null,{\"className\":\"w-full flex flex-col\",\"id\":\"main-content\",\"children\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[[\"$\",\"div\",null,{\"className\":\"self-center mt-7 max-w-2xl w-[80%]\",\"children\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(margined)\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(margined)\",\"children\",\"post\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(margined)\",\"children\",\"post\",\"children\",[\"slug\",\"2011/fileserver-3-samba\",\"c\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$L11\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":[\\\"2011\\\",\\\"fileserver-3-samba\\\"]}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/386fa29998ac6a74.css\",\"precedence\":\"next\"}]]}],\"segment\":[\"slug\",\"2011/fileserver-3-samba\",\"c\"]},\"styles\":[]}],\"segment\":\"post\"},\"styles\":[]}]}],null],\"segment\":\"(margined)\"},\"styles\":[]}]}]]}]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\na:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Scott O'Brien\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"My online creative outlet\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"any\"}]]\n"])</script><script>self.__next_f.push([1,"12:I{\"id\":\"9114\",\"chunks\":[\"962:static/chunks/962-226f429e9782fad0.js\",\"726:static/chunks/app/(margined)/post/[...slug]/page-063ddffa9c53bc9d.js\"],\"name\":\"\",\"async\":false}\n13:I{\"id\":\"5470\",\"chunks\":[\"91:static/chunks/app/flying/flight/[slug]/page-5440ec33784e9466.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"11:[\"$\",\"article\",null,{\"className\":\"\",\"children\":[\"$\",\"div\",null,{\"className\":\"__className_af3318 mb-9\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"__className_59b087 text-2xl\",\"children\":\"Allowing access through NFS \u0026 SAMBA\"}],[\"$\",\"div\",null,{\"className\":\"text-xs text-gray-400 italic mb-5\",\"children\":[\"Created: \",[\"$\",\"$L12\",null,{\"date\":\"$D2011-04-04T11:53:32.000Z\"}]]}],\"$undefined\",[\"$\",\"div\",null,{\"className\":\"prose lg:prose-lg\",\"children\":[\"$\",\"$L13\",null,{\"code\":\"var Component=(()=\u003e{var h=Object.create;var p=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var w=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var k=(n,e)=\u003e()=\u003e(e||n((e={exports:{}}).exports,e),e.exports),u=(n,e)=\u003e{for(var o in e)p(n,o,{get:e[o],enumerable:!0})},r=(n,e,o,a)=\u003e{if(e\u0026\u0026typeof e==\\\"object\\\"||typeof e==\\\"function\\\")for(let s of d(e))!B.call(n,s)\u0026\u0026s!==o\u0026\u0026p(n,s,{get:()=\u003ee[s],enumerable:!(a=_(e,s))||a.enumerable});return n};var g=(n,e,o)=\u003e(o=n!=null?h(w(n)):{},r(e||!n||!n.__esModule?p(o,\\\"default\\\",{value:n,enumerable:!0}):o,n)),y=n=\u003er(p({},\\\"__esModule\\\",{value:!0}),n);var l=k((L,m)=\u003e{m.exports=_jsx_runtime});var v={};u(v,{default:()=\u003ex,frontmatter:()=\u003eN});var t=g(l());var i=\\\"/posts/2011/fileserver-3-samba/image1-PCFS2IXR.png\\\";var N={title:\\\"Allowing access through NFS \u0026 SAMBA\\\",author:\\\"scottyob\\\",type:\\\"post\\\",date:new Date(1301918012e3),url:\\\"/2011/04/04/allowing-access-through-nfs-samba/\\\",categories:[\\\"FileServer\\\",\\\"nerd\\\"],tags:[\\\"CIFS\\\",\\\"NFS\\\",\\\"ZFS\\\"],hero:\\\"image1.png\\\",hideHero:!0};function c(n){let e=Object.assign({p:\\\"p\\\",h3:\\\"h3\\\",pre:\\\"pre\\\",code:\\\"code\\\",strong:\\\"strong\\\",ol:\\\"ol\\\",li:\\\"li\\\"},n.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.p,{children:\\\"This is in the series of setting up a fileserver.  We go through the process of setting up NFS \u0026 Samba.\\\"}),`\\n`,`\\n`,`\\n`,(0,t.jsx)(e.h3,{children:\\\"Cifs Share\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"CIFS (Common Internet File System), the protocol windows users for all it\\\\u2019s \\\\u2018windows file sharing\\\\u2019 is the method I\\\\u2019ll allow for my desktops and roaming computers to access files on the file server.\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"Before we begin, Make sure we install the CIFS kernal modules\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# pkg install SUNWsmbs \\n# pkg install SUNWsmbskr\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"next we issue this command to make sure it auto starts\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# svcadm enable -r smb/server\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"I've decided for every day use, I want a data store on the server, so..\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# zfs create datastore/homes \\n# zfs create datastore/homes/scott\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"now, set up compression on my home directory\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# zfs set compression=on datastore/homes\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"Time to do some setup so we can log into this share, I'll make the box join the workgroup \\\\u2018home\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# smbadm join -w home\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"To start sharing with windows boxes, I need to change the pam.conf file to generate windows passwords too. Add the line below /etc/pam.conf\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`\\nother password required pam_smb_passwd.so.1 nowarn\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"reset the password for my user scott, then I'll be able to authenticate with him\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# passwd scott\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"The next step is setting up guest access. You may remember we created a media share datastore/media. We want to share that with guests to the network (on the trusted subnet anyway). Before we go ahead and set that up, we want to map the windows Guest user to the unix user nobody.\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# idmap add winname:Guest unixuser:nobody\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"then we'll allow guest access to our media box\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# zfs set sharesmb=name=media,guestok=true datastore/media\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"I also want to make my home directory only accessible by me, so I\\\\u2019m going to own the directory\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`chown scott /datastore/homes/scott chgrp staff /datastore/homes/scott chmod 700 /datastore/homes/scott\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"and share it\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# zfs set sharesmb=name=scott datastore/homes/scott\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"So there we have it, a media folder anyone can access, and a \\\\u2018scott\\\\u2019 share that I\\\\u2019ll need to authenticate with (HOME\\\\\\\\scott user)\\\"}),`\\n`,(0,t.jsx)(\\\"img\\\",{src:i}),`\\n`,(0,t.jsx)(e.h3,{children:\\\"NFS Shares\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"Now we\\\\u2019ve got CIFS set up for our clients, I want to set up NFS shares for other Linux boxes on the network (at this point, only my router) to be able to access. The idea is that my router will have all the home directories on the FileServer (so it\\\\u2019ll get the advantages of snapshots, etc) we well as not being limited to the dying 60GB hard disk for torrenting and such things.\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"As mentioned, I\\\\u2019m only interested in NFS shares with my router at this point, so we\\\\u2019ll make sure my routers IP address (10.12.1.254) is restricted in the shares.\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"The first thing we want to try is setting up the nfs mount on our homes directory.\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# zfs set [sharenfs=root=@10.12.1.254,rw=@10.12.1.254](mailto:sharenfs=root=@10.12.1.254,rw=@10.12.1.254) datastore/homes\\n`})}),`\\n`,(0,t.jsxs)(e.p,{children:[\\\"Now, \\\",(0,t.jsx)(e.strong,{children:\\\"on my debian router box\\\"}),\\\" I want to see if I can mount this (assuming the directory /home2/scott exists on the client)\\\"]}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`sudo mount -t nfs -o nfsvers=3 10.12.1.1:/datastore/homes/scott /home2/scott\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"and Ta-Da! My home directory is mounted. What I want to do now is to set up auto-mounts. That is, when a directory is accessed for my users home directory, it\\\\u2019d mount it on the fly.\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"First, install the autofs package\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`apt-get install autofs\\n`})}),`\\n`,(0,t.jsxs)(e.p,{children:[\\\"Add the following line into \\\",(0,t.jsx)(e.strong,{children:\\\"/etc/auto.master\\\"})]}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`/home2 /etc/auto.home -\\\\u2013timeout=60\\n`})}),`\\n`,(0,t.jsxs)(e.p,{children:[\\\"and the following into the file \\\",(0,t.jsx)(e.strong,{children:\\\"/etc/auto.home\\\"})]}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`* -fstype=nfs,rw,nosuid,soft,vers=3 server:/datastore/homes/\u0026\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"the ***** and /datastore/homes/\u0026 do their magic by automatically mounting the required directory when needed (as long as the /etc/init.d/autofs is started)\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"Now lets add a place for our downloads\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`# zfs create datastore/media/downloads \\n# zfs set sharenfs=root=router,rw=router datastore/media/downloads\\n`})}),`\\n`,(0,t.jsxs)(e.p,{children:[\\\"I chose to just mount this using the automounter under the home2 directory, I added this to the \\\",(0,t.jsx)(e.strong,{children:\\\"/etc/auto.home\\\"}),\\\" file\\\"]}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`downloads -fstype=nfs,rw,nosuid,soft,vers=3 10.12.1.1:/datastore/media/downloads\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"Pretty neat, now when you head to a directory that's not mounted yet (like /home2/scott/) in the linux client, it will auto mount the required NFS volume and presto, we've got ourselves network storage.\\\"}),`\\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:\\\"Other posts to come in the series:\\\"})}),`\\n`,(0,t.jsxs)(e.ol,{children:[`\\n`,(0,t.jsx)(e.li,{children:\\\"Selecting the hardware\\\"}),`\\n`,(0,t.jsx)(e.li,{children:\\\"Installing the Operating System\\\"}),`\\n`,(0,t.jsx)(e.li,{children:\\\"Setting up File systems \u0026 Snapshots\\\"}),`\\n`,(0,t.jsx)(e.li,{children:\\\"Allowing access through NFS \u0026 SAMBA\\\"}),`\\n`,(0,t.jsx)(e.li,{children:\\\"Setting up encrypted off-site backups\\\"}),`\\n`,(0,t.jsx)(e.li,{children:\\\"Configuring Windows \u0026 Linux clients to dump backup info to the FileServer\\\"}),`\\n`,(0,t.jsx)(e.li,{children:\\\"My router setup, configuring IP tables \u0026 torrents on a low-powered server.\\\"}),`\\n`]})]})}function f(n={}){let{wrapper:e}=n.components||{};return e?(0,t.jsx)(e,Object.assign({},n,{children:(0,t.jsx)(c,n)})):c(n)}var x=f;return y(v);})();\\n;return Component;\"}]}]]}]}]\n"])</script></body></html>