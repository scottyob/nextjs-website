1:HL["/_next/static/css/70a6988bfc142772.css",{"as":"style"}]
0:["aQlZSs9CDQ5o1878iGuKG",[[["",{"children":["(navbar)",{"children":["(margined)",{"children":["post",{"children":[["slug","2012/georestricted-tunneling","c"],{"children":["__PAGE__?{\"slug\":[\"2012\",\"georestricted-tunneling\"]}",{}]}]}]}]}]},"$undefined","$undefined",true],"$L2",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/70a6988bfc142772.css","precedence":"next"}]],"$L3"]]]]
4:HL["/_next/static/media/42e58f5a516ebb1b-s.p.woff2",{"as":"font","type":"font/woff2"}]
5:HL["/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2",{"as":"font","type":"font/woff2"}]
6:HL["/_next/static/media/d45575ed0ad4f563-s.p.woff2",{"as":"font","type":"font/woff2"}]
7:HL["/_next/static/css/d699b3284dd0f0c8.css",{"as":"style"}]
8:HL["/_next/static/media/8679c800f1e60000-s.p.woff2",{"as":"font","type":"font/woff2"}]
9:HL["/_next/static/media/af1939b13935fec8-s.p.woff2",{"as":"font","type":"font/woff2"}]
a:HL["/_next/static/css/e1665b43251c86eb.css",{"as":"style"}]
b:I{"id":7767,"chunks":["272:static/chunks/webpack-c0d6ce99d471eac9.js","971:static/chunks/fd9d1056-f562485b1666a0a3.js","596:static/chunks/596-5b64dbf019a905f5.js"],"name":"default","async":false}
c:I{"id":7920,"chunks":["272:static/chunks/webpack-c0d6ce99d471eac9.js","971:static/chunks/fd9d1056-f562485b1666a0a3.js","596:static/chunks/596-5b64dbf019a905f5.js"],"name":"default","async":false}
d:I{"id":6685,"chunks":["685:static/chunks/685-a0750907e0c935bc.js","222:static/chunks/222-0c303d3189115893.js","982:static/chunks/982-07d375c9d37b134d.js","46:static/chunks/app/(navbar)/(margined)/page-4623163d6cd3c237.js"],"name":"","async":false}
e:I{"id":2179,"chunks":["724:static/chunks/358ff52d-5af8921f222f7c20.js","122:static/chunks/e416a3ff-be1b889799c50168.js","447:static/chunks/00cbbcb7-5522c112e5f40d45.js","685:static/chunks/685-a0750907e0c935bc.js","713:static/chunks/app/(navbar)/layout-53648850bb136a0a.js"],"name":"","async":false}
2:[["$","html",null,{"lang":"en","children":["$","$Lb",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Lc",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":[["$","body",null,{"className":"__className_e66fe9","children":["$","div",null,{"className":"flex max-w-full w-full flex-col pt-8 pb-8","children":[["$","div",null,{"className":"self-center w-full","children":[["$","h1",null,{"className":"text-center text-4xl __className_31da3a","children":["$","$Ld",null,{"href":"/","children":"Scott O'Brien"}]}],["$","$Le",null,{}]]}],["$","div",null,{"className":"w-full flex flex-col","id":"main-content","children":["$","$Lb",null,{"parallelRouterKey":"children","segmentPath":["children","(navbar)","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Lc",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":[["$","div",null,{"className":"self-center mt-7 max-w-2xl w-[80%]","children":["$","$Lb",null,{"parallelRouterKey":"children","segmentPath":["children","(navbar)","children","(margined)","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Lc",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$Lb",null,{"parallelRouterKey":"children","segmentPath":["children","(navbar)","children","(margined)","children","post","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Lc",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$Lb",null,{"parallelRouterKey":"children","segmentPath":["children","(navbar)","children","(margined)","children","post","children",["slug","2012/georestricted-tunneling","c"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Lc",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$Lf",null],"segment":"__PAGE__?{\"slug\":[\"2012\",\"georestricted-tunneling\"]}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/e1665b43251c86eb.css","precedence":"next"}]]}],"segment":["slug","2012/georestricted-tunneling","c"]},"styles":[]}],"segment":"post"},"styles":[]}]}],null],"segment":"(margined)"},"styles":[]}]}]]}]}],null],"segment":"(navbar)"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/d699b3284dd0f0c8.css","precedence":"next"}]]}]}],null]
3:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Scott O'Brien"}],["$","meta","2",{"name":"description","content":"My online creative outlet"}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}],["$","meta","5",{"name":"next-size-adjust"}]]
10:I{"id":8248,"chunks":["222:static/chunks/222-0c303d3189115893.js","982:static/chunks/982-07d375c9d37b134d.js","344:static/chunks/app/(navbar)/(margined)/post/[...slug]/page-a0f72aa7860b7ab0.js"],"name":"","async":false}
11:I{"id":9098,"chunks":["222:static/chunks/222-0c303d3189115893.js","982:static/chunks/982-07d375c9d37b134d.js","344:static/chunks/app/(navbar)/(margined)/post/[...slug]/page-a0f72aa7860b7ab0.js"],"name":"","async":false}
12:T140e,var Component=(()=>{var x=Object.create;var r=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var d=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty;var p=(E,e)=>()=>(e||E((e={exports:{}}).exports,e),e.exports),h=(E,e)=>{for(var t in e)r(E,t,{get:e[t],enumerable:!0})},Q=(E,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of u(e))!l.call(E,o)&&o!==t&&r(E,o,{get:()=>e[o],enumerable:!(s=m(e,o))||s.enumerable});return E};var g=(E,e,t)=>(t=E!=null?x(d(E)):{},Q(e||!E||!E.__esModule?r(t,"default",{value:E,enumerable:!0}):t,E)),k=E=>Q(r({},"__esModule",{value:!0}),E);var P=p((Z,i)=>{i.exports=_jsx_runtime});var f={};h(f,{default:()=>y,frontmatter:()=>w});var n=g(P());var a="/posts/2012/georestricted-tunneling/Network-Config-NXX6FUWM.jpg";var w={title:"Easily accessing GeoIP restricted sites in your network.",author:"scottyob",type:"post",date:new Date(1338721505e3),url:"/2012/06/03/easily-accessing-geoip-restricted-sites-in-your-network/",categories:["nerd"],hero:"Network-Config.jpg",hideHero:!0};function c(E){let e=Object.assign({p:"p",pre:"pre",code:"code"},E.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:"We all know the problem, some sites are restricted to certain countries based on the IP address you're using to view them. \xA0When trying to access over-seas, some solutions are HTTP proxies, Socks proxies and the like. \xA0The problem I have with all of these is that they're annoying to set up whenever you want to to view the site and I don't want to have to do that for all my devices (iPad, computer, etc)."}),`
`,(0,n.jsx)(e.p,{children:"This solution will tunnel only the sites you want over a VPN\xA0connection\xA0to be NAT'd out the other end, all on the gateway"}),`
`,`
`,(0,n.jsx)("img",{src:a,alt:"Network Config"}),`
`,(0,n.jsx)(e.p,{children:"First we want to set up OpenVPN on the remote host by issuing \u201Copenvpn \u2013genkey \u2013secret static.key\u201D then creating a file in (/etc/openvpn/server.conf)"}),`
`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`# Network
port 1194
proto tcp-server
dev tun
ifconfig 10.0.6.1 10.0.6.2

# Crypto
secret /etc/openvpn/static.key
comp-lzo
keepalive 10 120

# Security
persist-key
persist-tun

# Logging
status openvpn-status.log
`})}),`
`,(0,n.jsx)(e.p,{children:"One thing we need to do on the server is set up NAT on the outbound address (to make sure all traffic that passes our VPS destined for the internet looks like it's from that US IP address)"}),`
`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`# Previously initiated and accepted exchanges bypass rule checking
# Allow unlimited outbound traffic
/sbin/iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
/sbin/iptables -A OUTPUT -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT

iptables -t nat -A POSTROUTING -s 10.0.6.0/24 -o eth0 -j MASQUERADE
echo 1 > /proc/sys/net/ipv4/ip_forward
`})}),`
`,(0,n.jsx)(e.p,{children:"On the client side, things look very similar,"}),`
`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`remote vps.server.com 1194 tcp-client
persist-key
comp-lzo no
redirect-gateway def1
nobind
persist-tun
secret secret.key
dev tun
ifconfig 10.0.6.2. 10.0.6.1
`})}),`
`,(0,n.jsx)(e.p,{children:"On the client, I just also MASQUERADE'd data though (I know, double NAT'ing, easier then adjusting routing table on the VPS)"}),`
`,(0,n.jsx)(e.p,{children:"Now for the magic to happen. I just replaced the DNS server on my home router with a little Python script (\u2764\uFE0F Twisted framework) to proxy requests, adding a tunnel for IP's that get returned by sites in my list (in this case I've chosen two fictious sites, HooLoo.com and pandoor.com"}),`
`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:"language-py",children:`from twisted.internet.protocol import Factory, Protocol
from twisted.internet import reactor
from twisted.names import dns
from twisted.names import client, server
import subprocess
from sys import exit

tunnelDomains = [
  "pandoor.com",
  "hooloo.com"
]
dnsServers = [("203.12.160.35", 53), ("203.12.160.36", 53)]

def tunnel(address):
       subprocess.call(["route", "add", address + "/32", "tun0"])  

class SpelDnsReolver(client.Resolver):
  def filterAnswers(self, message):
    if message.trunc:
      return self.queryTCP(message.queries).addCallback(self.filterAnswers)
    else:
      for d in tunnelDomains:
        if str(message.queries[0].name).endswith(d):
          for answer in message.answers:
            if answer.type == 1: #A record
              tunnel(answer.payload.dottedQuad())

    return (message.answers, message.authority, message.additional)

verbosity = 0
resolver = SpelDnsReolver(servers=dnsServers)
f = server.DNSServerFactory(clients=[resolver], verbose=verbosity)
p = dns.DNSDatagramProtocol(f)
f.noisy = p.noisy = verbosity

reactor.listenUDP(53, p)
reactor.listenTCP(53, f)
reactor.run()
`})})]})}function _(E={}){let{wrapper:e}=E.components||{};return e?(0,n.jsx)(e,Object.assign({},E,{children:(0,n.jsx)(c,E)})):c(E)}var y=_;return k(f);})();
;return Component;f:["$","article",null,{"className":"","children":["$","div",null,{"className":"__className_12746b mb-9","children":[["$","h2",null,{"className":"__className_df02b7 text-2xl","children":"Easily accessing GeoIP restricted sites in your network."}],["$","div",null,{"className":"text-xs text-gray-400 italic mb-5","children":["Created: ",["$","$L10",null,{"date":"$D2012-06-03T11:05:05.000Z"}]]}],"$undefined",["$","div",null,{"className":"prose lg:prose-lg","children":["$","$L11",null,{"code":"$12"}]}]]}]}]
