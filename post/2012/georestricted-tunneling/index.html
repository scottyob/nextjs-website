<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="preload" as="font" href="/_next/static/media/2aaf0723e720e8b9-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/42e58f5a516ebb1b-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/4e8dfc5aa8742fdc-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/4c1c321c249fa2d1-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/8679c800f1e60000-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/0d26c7c4f71e78d1.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/99e3bcfff854f17e.css" data-precedence="next"/><title>Scott O&#x27;Brien</title><meta name="description" content="My online creative outlet"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_0ec1f4"><div class="flex max-w-full w-full flex-col pt-8 pb-8"><div class="self-center w-full"><h1 class="text-center text-4xl __className_baad2a"><a href="/">Scott O&#x27;Brien</a></h1><ul class="flex flex-wrap justify-center space-x-2 text-gray-400 italic pt-3 mb-8 max-w-2xl w-[80%] m-auto __className_6cf34a"><li class="transition group duration-300 whitespace-nowrap"><a href="/">Writings/Projects</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-[70%] bg-orange-500"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/about/">About</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/bucketlist/">Bucket List</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/recipes/">Cooking</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/flying/">Flying</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li></ul></div><div class="w-full flex flex-col" id="main-content"><div class="self-center mt-7 max-w-2xl w-[80%]"><article class=""><div class="__className_2e19ce mb-9"><h2 class="__className_59b087 text-2xl">Easily accessing GeoIP restricted sites in your network.</h2><div class="text-xs text-gray-400 italic mb-5">Created: <span>6/3/2012, 11:05:05 AM</span></div><div class="prose lg:prose-lg"><p>We all know the problem, some sites are restricted to certain countries based on the IP address you&#x27;re using to view them.  When trying to access over-seas, some solutions are HTTP proxies, Socks proxies and the like.  The problem I have with all of these is that they&#x27;re annoying to set up whenever you want to to view the site and I don&#x27;t want to have to do that for all my devices (iPad, computer, etc).</p>
<p>This solution will tunnel only the sites you want over a VPN connection to be NAT&#x27;d out the other end, all on the gateway</p>
<!-- -->
<img src="/posts/2012/georestricted-tunneling/Network-Config-NXX6FUWM.jpg" alt="Network Config"/>
<p>First we want to set up OpenVPN on the remote host by issuing “openvpn –genkey –secret static.key” then creating a file in (/etc/openvpn/server.conf)</p>
<pre><code># Network
port 1194
proto tcp-server
dev tun
ifconfig 10.0.6.1 10.0.6.2

# Crypto
secret /etc/openvpn/static.key
comp-lzo
keepalive 10 120

# Security
persist-key
persist-tun

# Logging
status openvpn-status.log
</code></pre>
<p>One thing we need to do on the server is set up NAT on the outbound address (to make sure all traffic that passes our VPS destined for the internet looks like it&#x27;s from that US IP address)</p>
<pre><code># Previously initiated and accepted exchanges bypass rule checking
# Allow unlimited outbound traffic
/sbin/iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
/sbin/iptables -A OUTPUT -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT

iptables -t nat -A POSTROUTING -s 10.0.6.0/24 -o eth0 -j MASQUERADE
echo 1 &gt; /proc/sys/net/ipv4/ip_forward
</code></pre>
<p>On the client side, things look very similar,</p>
<pre><code>remote vps.server.com 1194 tcp-client
persist-key
comp-lzo no
redirect-gateway def1
nobind
persist-tun
secret secret.key
dev tun
ifconfig 10.0.6.2. 10.0.6.1
</code></pre>
<p>On the client, I just also MASQUERADE&#x27;d data though (I know, double NAT&#x27;ing, easier then adjusting routing table on the VPS)</p>
<p>Now for the magic to happen. I just replaced the DNS server on my home router with a little Python script (❤️ Twisted framework) to proxy requests, adding a tunnel for IP&#x27;s that get returned by sites in my list (in this case I&#x27;ve chosen two fictious sites, HooLoo.com and pandoor.com</p>
<pre><code class="language-py">from twisted.internet.protocol import Factory, Protocol
from twisted.internet import reactor
from twisted.names import dns
from twisted.names import client, server
import subprocess
from sys import exit

tunnelDomains = [
  &quot;pandoor.com&quot;,
  &quot;hooloo.com&quot;
]
dnsServers = [(&quot;203.12.160.35&quot;, 53), (&quot;203.12.160.36&quot;, 53)]

def tunnel(address):
       subprocess.call([&quot;route&quot;, &quot;add&quot;, address + &quot;/32&quot;, &quot;tun0&quot;])  

class SpelDnsReolver(client.Resolver):
  def filterAnswers(self, message):
    if message.trunc:
      return self.queryTCP(message.queries).addCallback(self.filterAnswers)
    else:
      for d in tunnelDomains:
        if str(message.queries[0].name).endswith(d):
          for answer in message.answers:
            if answer.type == 1: #A record
              tunnel(answer.payload.dottedQuad())

    return (message.answers, message.authority, message.additional)

verbosity = 0
resolver = SpelDnsReolver(servers=dnsServers)
f = server.DNSServerFactory(clients=[resolver], verbose=verbosity)
p = dns.DNSDatagramProtocol(f)
f.noisy = p.noisy = verbosity

reactor.listenUDP(53, p)
reactor.listenTCP(53, f)
reactor.run()
</code></pre></div></div></article></div></div></div><script src="/_next/static/chunks/webpack-f503b2c49e415ac7.js" async=""></script><script src="/_next/static/chunks/bce60fc1-e7cb3874f5f47943.js" async=""></script><script src="/_next/static/chunks/488-f907c6837e991d02.js" async=""></script><script src="/_next/static/chunks/main-app-fd28149d965ecf3e.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/2aaf0723e720e8b9-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/42e58f5a516ebb1b-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/media/4e8dfc5aa8742fdc-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/0d26c7c4f71e78d1.css\",{\"as\":\"style\"}]\n0:\"$L5\"\n"])</script><script>self.__next_f.push([1,"6:HL[\"/_next/static/media/4c1c321c249fa2d1-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n7:HL[\"/_next/static/media/8679c800f1e60000-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n8:HL[\"/_next/static/css/99e3bcfff854f17e.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"9:I{\"id\":\"8827\",\"chunks\":[\"272:static/chunks/webpack-f503b2c49e415ac7.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"488:static/chunks/488-f907c6837e991d02.js\"],\"name\":\"\",\"async\":false}\nb:I{\"id\":\"9126\",\"chunks\":[\"272:static/chunks/webpack-f503b2c49e415ac7.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"488:static/chunks/488-f907c6837e991d02.js\"],\"name\":\"\",\"async\":false}\nc:I{\"id\":\"8920\",\"chunks\":[\"920:static/chunks/920-beeca0bfb1d2369e.js\",\"348:static/chunks/348-700824deec928208.js\",\"304:static/"])</script><script>self.__next_f.push([1,"chunks/304-79fa6ad07eecf6c9.js\",\"534:static/chunks/app/flying/location/[slug]/page-1764d82524f789b4.js\"],\"name\":\"\",\"async\":false}\nd:I{\"id\":\"558\",\"chunks\":[\"920:static/chunks/920-beeca0bfb1d2369e.js\",\"185:static/chunks/app/layout-33994cd5ee6d865f.js\"],\"name\":\"\",\"async\":false}\nf:I{\"id\":\"4463\",\"chunks\":[\"272:static/chunks/webpack-f503b2c49e415ac7.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"488:static/chunks/488-f907c6837e991d02.js\"],\"name\":\"\",\"async\":false}\n10:I{\"id\":\"1010\",\"chunks\":[\"272:static/chun"])</script><script>self.__next_f.push([1,"ks/webpack-f503b2c49e415ac7.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"488:static/chunks/488-f907c6837e991d02.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"5:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0d26c7c4f71e78d1.css\",\"precedence\":\"next\"}]],[\"$\",\"$L9\",null,{\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/post/2012/georestricted-tunneling/\",\"initialTree\":[\"\",{\"children\":[\"(margined)\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"2012/georestricted-tunneling\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"2012\\\",\\\"georestricted-tunneling\\\"]}\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[\"$La\",[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]],\"globalErrorComponent\":\"$b\",\"notFound\":[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_0ec1f4\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex max-w-full w-full flex-col pt-8 pb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"self-center w-full\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-center text-4xl __className_baad2a\",\"children\":[\"$\",\"$Lc\",null,{\"href\":\"/\",\"children\":\"Scott O'Brien\"}]}],[\"$\",\"$Ld\",null,{}]]}],[\"$\",\"div\",null,{\"className\":\"w-full flex flex-col\",\"id\":\"main-content\",\"children\":[\"$Le\",\"$undefined\",[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]]}]]}]}]}],\"asNotFound\":false,\"children\":[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_0ec1f4\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex max-w-full w-full flex-col pt-8 pb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"self-center w-full\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-center text-4xl __className_baad2a\",\"children\":[\"$\",\"$Lc\",null,{\"href\":\"/\",\"children\":\"Scott O'Brien\"}]}],[\"$\",\"$Ld\",null,{}]]}],[\"$\",\"div\",null,{\"className\":\"w-full flex flex-col\",\"id\":\"main-content\",\"children\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[[\"$\",\"div\",null,{\"className\":\"self-center mt-7 max-w-2xl w-[80%]\",\"children\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(margined)\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(margined)\",\"children\",\"post\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(margined)\",\"children\",\"post\",\"children\",[\"slug\",\"2012/georestricted-tunneling\",\"c\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$L11\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":[\\\"2012\\\",\\\"georestricted-tunneling\\\"]}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/99e3bcfff854f17e.css\",\"precedence\":\"next\"}]]}],\"segment\":[\"slug\",\"2012/georestricted-tunneling\",\"c\"]},\"styles\":[]}],\"segment\":\"post\"},\"styles\":[]}]}],null],\"segment\":\"(margined)\"},\"styles\":[]}]}]]}]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\na:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Scott O'Brien\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"My online creative outlet\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"any\"}]]\n"])</script><script>self.__next_f.push([1,"12:I{\"id\":\"8288\",\"chunks\":[\"707:static/chunks/707-e3070078e72f1aa2.js\",\"726:static/chunks/app/(margined)/post/[...slug]/page-824ad804da7b0d15.js\"],\"name\":\"\",\"async\":false}\n13:I{\"id\":\"2853\",\"chunks\":[\"91:static/chunks/app/flying/flight/[slug]/page-96287e22abdff0cd.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"11:[\"$\",\"article\",null,{\"className\":\"\",\"children\":[\"$\",\"div\",null,{\"className\":\"__className_2e19ce mb-9\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"__className_59b087 text-2xl\",\"children\":\"Easily accessing GeoIP restricted sites in your network.\"}],[\"$\",\"div\",null,{\"className\":\"text-xs text-gray-400 italic mb-5\",\"children\":[\"Created: \",[\"$\",\"$L12\",null,{\"date\":\"$D2012-06-03T11:05:05.000Z\"}]]}],\"$undefined\",[\"$\",\"div\",null,{\"className\":\"prose lg:prose-lg\",\"children\":[\"$\",\"$L13\",null,{\"code\":\"var Component=(()=\u003e{var x=Object.create;var r=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var d=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty;var p=(E,e)=\u003e()=\u003e(e||E((e={exports:{}}).exports,e),e.exports),h=(E,e)=\u003e{for(var t in e)r(E,t,{get:e[t],enumerable:!0})},Q=(E,e,t,s)=\u003e{if(e\u0026\u0026typeof e==\\\"object\\\"||typeof e==\\\"function\\\")for(let o of u(e))!l.call(E,o)\u0026\u0026o!==t\u0026\u0026r(E,o,{get:()=\u003ee[o],enumerable:!(s=m(e,o))||s.enumerable});return E};var g=(E,e,t)=\u003e(t=E!=null?x(d(E)):{},Q(e||!E||!E.__esModule?r(t,\\\"default\\\",{value:E,enumerable:!0}):t,E)),k=E=\u003eQ(r({},\\\"__esModule\\\",{value:!0}),E);var P=p((Z,i)=\u003e{i.exports=_jsx_runtime});var f={};h(f,{default:()=\u003ey,frontmatter:()=\u003ew});var n=g(P());var a=\\\"/posts/2012/georestricted-tunneling/Network-Config-NXX6FUWM.jpg\\\";var w={title:\\\"Easily accessing GeoIP restricted sites in your network.\\\",author:\\\"scottyob\\\",type:\\\"post\\\",date:new Date(1338721505e3),url:\\\"/2012/06/03/easily-accessing-geoip-restricted-sites-in-your-network/\\\",categories:[\\\"nerd\\\"],hero:\\\"Network-Config.jpg\\\",hideHero:!0};function c(E){let e=Object.assign({p:\\\"p\\\",pre:\\\"pre\\\",code:\\\"code\\\"},E.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:\\\"We all know the problem, some sites are restricted to certain countries based on the IP address you're using to view them. \\\\xA0When trying to access over-seas, some solutions are HTTP proxies, Socks proxies and the like. \\\\xA0The problem I have with all of these is that they're annoying to set up whenever you want to to view the site and I don't want to have to do that for all my devices (iPad, computer, etc).\\\"}),`\\n`,(0,n.jsx)(e.p,{children:\\\"This solution will tunnel only the sites you want over a VPN\\\\xA0connection\\\\xA0to be NAT'd out the other end, all on the gateway\\\"}),`\\n`,`\\n`,(0,n.jsx)(\\\"img\\\",{src:a,alt:\\\"Network Config\\\"}),`\\n`,(0,n.jsx)(e.p,{children:\\\"First we want to set up OpenVPN on the remote host by issuing \\\\u201Copenvpn \\\\u2013genkey \\\\u2013secret static.key\\\\u201D then creating a file in (/etc/openvpn/server.conf)\\\"}),`\\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`# Network\\nport 1194\\nproto tcp-server\\ndev tun\\nifconfig 10.0.6.1 10.0.6.2\\n\\n# Crypto\\nsecret /etc/openvpn/static.key\\ncomp-lzo\\nkeepalive 10 120\\n\\n# Security\\npersist-key\\npersist-tun\\n\\n# Logging\\nstatus openvpn-status.log\\n`})}),`\\n`,(0,n.jsx)(e.p,{children:\\\"One thing we need to do on the server is set up NAT on the outbound address (to make sure all traffic that passes our VPS destined for the internet looks like it's from that US IP address)\\\"}),`\\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`# Previously initiated and accepted exchanges bypass rule checking\\n# Allow unlimited outbound traffic\\n/sbin/iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\\n/sbin/iptables -A OUTPUT -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT\\n\\niptables -t nat -A POSTROUTING -s 10.0.6.0/24 -o eth0 -j MASQUERADE\\necho 1 \u003e /proc/sys/net/ipv4/ip_forward\\n`})}),`\\n`,(0,n.jsx)(e.p,{children:\\\"On the client side, things look very similar,\\\"}),`\\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`remote vps.server.com 1194 tcp-client\\npersist-key\\ncomp-lzo no\\nredirect-gateway def1\\nnobind\\npersist-tun\\nsecret secret.key\\ndev tun\\nifconfig 10.0.6.2. 10.0.6.1\\n`})}),`\\n`,(0,n.jsx)(e.p,{children:\\\"On the client, I just also MASQUERADE'd data though (I know, double NAT'ing, easier then adjusting routing table on the VPS)\\\"}),`\\n`,(0,n.jsx)(e.p,{children:\\\"Now for the magic to happen. I just replaced the DNS server on my home router with a little Python script (\\\\u2764\\\\uFE0F Twisted framework) to proxy requests, adding a tunnel for IP's that get returned by sites in my list (in this case I've chosen two fictious sites, HooLoo.com and pandoor.com\\\"}),`\\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\\\"language-py\\\",children:`from twisted.internet.protocol import Factory, Protocol\\nfrom twisted.internet import reactor\\nfrom twisted.names import dns\\nfrom twisted.names import client, server\\nimport subprocess\\nfrom sys import exit\\n\\ntunnelDomains = [\\n  \\\"pandoor.com\\\",\\n  \\\"hooloo.com\\\"\\n]\\ndnsServers = [(\\\"203.12.160.35\\\", 53), (\\\"203.12.160.36\\\", 53)]\\n\\ndef tunnel(address):\\n       subprocess.call([\\\"route\\\", \\\"add\\\", address + \\\"/32\\\", \\\"tun0\\\"])  \\n\\nclass SpelDnsReolver(client.Resolver):\\n  def filterAnswers(self, message):\\n    if message.trunc:\\n      return self.queryTCP(message.queries).addCallback(self.filterAnswers)\\n    else:\\n      for d in tunnelDomains:\\n        if str(message.queries[0].name).endswith(d):\\n          for answer in message.answers:\\n            if answer.type == 1: #A record\\n              tunnel(answer.payload.dottedQuad())\\n\\n    return (message.answers, message.authority, message.additional)\\n\\nverbosity = 0\\nresolver = SpelDnsReolver(servers=dnsServers)\\nf = server.DNSServerFactory(clients=[resolver], verbose=verbosity)\\np = dns.DNSDatagramProtocol(f)\\nf.noisy = p.noisy = verbosity\\n\\nreactor.listenUDP(53, p)\\nreactor.listenTCP(53, f)\\nreactor.run()\\n`})})]})}function _(E={}){let{wrapper:e}=E.components||{};return e?(0,n.jsx)(e,Object.assign({},E,{children:(0,n.jsx)(c,E)})):c(E)}var y=_;return k(f);})();\\n;return Component;\"}]}]]}]}]\n"])</script></body></html>