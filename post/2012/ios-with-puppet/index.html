<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="preload" as="font" href="/_next/static/media/2aaf0723e720e8b9-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/42e58f5a516ebb1b-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/4e8dfc5aa8742fdc-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/4c1c321c249fa2d1-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/8679c800f1e60000-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/0d26c7c4f71e78d1.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/99e3bcfff854f17e.css" data-precedence="next"/><title>Scott O&#x27;Brien</title><meta name="description" content="My online creative outlet"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_0ec1f4"><div class="flex max-w-full w-full flex-col pt-8 pb-8"><div class="self-center w-full"><h1 class="text-center text-4xl __className_baad2a"><a href="/">Scott O&#x27;Brien</a></h1><ul class="flex flex-wrap justify-center space-x-2 text-gray-400 italic pt-3 mb-8 max-w-2xl w-[80%] m-auto __className_6cf34a"><li class="transition group duration-300 whitespace-nowrap"><a href="/">Writings/Projects</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-[70%] bg-orange-500"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/about/">About</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/bucketlist/">Bucket List</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/recipes/">Cooking</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/flying/">Flying</a><span class="block group-hover:max-w-[70%] ml-2 transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li></ul></div><div class="w-full flex flex-col" id="main-content"><div class="self-center mt-7 max-w-2xl w-[80%]"><article class=""><div class="__className_2e19ce mb-9"><h2 class="__className_59b087 text-2xl">My experiences of managing a Cisco switch with Puppet</h2><div class="text-xs text-gray-400 italic mb-5">Created: <!-- -->12/8/2012</div><img alt="Post picture" loading="lazy" width="507" height="319" decoding="async" data-nimg="1" class="m-auto mb-5" style="color:transparent" src="/_next/static/media/IOU-Web-Interface-Laboratories.e92325c4.jpg"/><div class="prose lg:prose-lg"><p>One recent pet gripe of mine has been having to add a new VLAN into our datacenter for our vSphere platform. ¬†Not that I trust my DCs switches with puppet just yet, this is a proof of concept post about how we could be using puppet to centrally manage this configuration and push it out across our DC.</p>
<!-- -->
<h3>Before</h3>
<p>We&#x27;ve got a pretty basic topology going on in our DC, it&#x27;s just a VSS with the other switches pretty much being nothing more but layer 2 for the most part. ¬†The dot1q trunk back to the VSS carries all VLANs from our end of row switches. ¬†When we add a new vlan in the DC to trunk to the ESX machines, we would add the VLAN in all the DC switches (not running VTP) then add the vlan to the trunk port on each port patched to the ESX hosts. ¬†(we&#x27;re not using any link aggregation to the ports connected to the same ESX host, the ESX hosts themselves have their own load balancing method.. If you know any for/against doing it like this please comment and let me know)</p>
<h3><strong>Setting up the Puppet lab</strong></h3>
<p>Introduced in Puppet 2.7 is <a href="http://puppetlabs.com/blog/puppet-network-device-management/">network device management</a>. ¬†This more or less is an expect script to manage interfaces and vlans on IOS devices. ¬†For this lab, we will be using cisco IOU with the following topology</p>
<img src="/posts/2012/ios-with-puppet/IOU-Web-Interface-Laboratories-5ERSLRAL.jpg"/>
<h4>Setting up the Devices</h4>
<p>Ideally, you would have a few puppet nodes that manage a few devices each to spread out the load, for the purposes of this exercise, I created a single vm running Centos6 with both puppet-server and puppet installed. ¬†For this machine to manage the switches, I added the following into the device.conf file</p>
<pre><code class="language-[root@localhost">[dc_sw1]
type cisco
url telnet://puppet:cisco@10.0.1.131/
[dc_sw2]
type cisco
url telnet://puppet:cisco@10.0.1.132/
[dc_sw3]
type cisco
url telnet://puppet:cisco@10.0.1.133/
[dc_sw4]
type cisco
url telnet://puppet:cisco@10.0.1.134/
</code></pre>
<h3>Signing the devices</h3>
<p>To update the devices, you have to run¬†<strong>puppet device</strong>. ¬†The first time you run it, a certificate will be created that needs to be signed on the puppet master.</p>
<pre><code class="language-[root@localhost">info: starting applying configuration to dc_sw4 at telnet://puppet:cisco@10.0.1.134/
info: Creating a new SSL key for dc_sw4
warning: peer certificate won&#x27;t be verified in this SSL session
info: Caching certificate for ca
warning: peer certificate won&#x27;t be verified in this SSL session
warning: peer certificate won&#x27;t be verified in this SSL session
info: Creating a new SSL certificate request for dc_sw4
info: Certificate Request fingerprint (md5): E8:A6:35:9D:BF:CE:3D:BC:E0:E4:C2:5B:00:CE:9F:DB
warning: peer certificate won&#x27;t be verified in this SSL session
warning: peer certificate won&#x27;t be verified in this SSL session
warning: peer certificate won&#x27;t be verified in this SSL session
</code></pre>
<p>so we&#x27;ll need to sign our devices</p>
<pre><code class="language-[root@localhost">notice: Signed certificate request for dc_sw4
notice: Removing file Puppet::SSL::CertificateRequest dc_sw4 at &#x27;/var/lib/puppet/ssl/ca/requests/dc_sw4.pem&#x27;
</code></pre>
<h3>Setting up the switches for Puppet</h3>
<p>If you look up to the device configuration file, we need to create a local user for puppet to log into the switch (remember, it acts much like an expect script)</p>
<pre><code class="language-username">line vty 0 4
privilege level 15
password cisco
login local
transport input all
!
</code></pre>
<h3>The Configuration</h3>
<p>so with no more ado, we can easily simply abstract the behaviour of these ports using puppet syntax üôÇ</p>
<pre><code class="language-define">
interface {
&quot;${port}&quot;:
mode =&gt; trunk,
duplex =&gt; full,
description =&gt; &quot;ESX Host&quot;,
allowed_trunk_vlans =&gt; &quot;3,4,5,8,9&quot;
}

}

node &quot;dc_sw1&quot; {

esxport { &#x27;e0/2&#x27;: port =&gt; &#x27;Ethernet0/2&#x27; }
esxport { &#x27;e0/3&#x27;: port =&gt; &#x27;Ethernet0/3&#x27; }

}

node &quot;dc_sw2&quot; {

esxport { &#x27;e1/0&#x27;: port =&gt; &#x27;Ethernet1/0&#x27; }
esxport { &#x27;e1/1&#x27;: port =&gt; &#x27;Ethernet1/1&#x27; }
esxport { &#x27;e1/2&#x27;: port =&gt; &#x27;Ethernet1/2&#x27; }
esxport { &#x27;e1/3&#x27;: port =&gt; &#x27;Ethernet1/3&#x27; }

}
</code></pre>
<h4>The Ugly</h4>
<p>A lot of the states don&#x27;t yet seem to be supported by this module. ¬†This means even the default trunk mode of dynamic desirable will cause issues when Puppet is pulling device information and you&#x27;ll have to manually specify ‚Äúswitchport trunk encapsulation dot1q‚Äù and ‚Äúswitchport mode access‚Äù before setting puppet free on the devices.</p>
<h4>Results</h4>
<pre><code class="language-[root@localhost">info: starting applying configuration to dc_sw4 at telnet://puppet:cisco@10.0.1.134/
info: Caching catalog for dc_sw4
info: Applying configuration version &#x27;1355007108&#x27;
notice: Finished catalog run in 0.20 seconds
info: starting applying configuration to dc_sw3 at telnet://puppet:cisco@10.0.1.133/
info: Caching catalog for dc_sw3
info: Applying configuration version &#x27;1355007108&#x27;
notice: Finished catalog run in 0.21 seconds
info: starting applying configuration to dc_sw2 at telnet://puppet:cisco@10.0.1.132/
info: Caching catalog for dc_sw2
info: Applying configuration version &#x27;1355007108&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/1]/Interface[Ethernet1/1]/description: defined &#x27;description&#x27; as &#x27;ESX Host&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/1]/Interface[Ethernet1/1]/duplex: duplex changed &#x27;auto&#x27; to &#x27;full&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/1]/Interface[Ethernet1/1]/mode: mode changed &#x27;access&#x27; to &#x27;trunk&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/1]/Interface[Ethernet1/1]/allowed_trunk_vlans: defined &#x27;allowed_trunk_vlans&#x27; as &#x27;3,4,5,8,9&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/3]/Interface[Ethernet1/3]/description: defined &#x27;description&#x27; as &#x27;ESX Host&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/3]/Interface[Ethernet1/3]/duplex: duplex changed &#x27;auto&#x27; to &#x27;full&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/3]/Interface[Ethernet1/3]/mode: mode changed &#x27;access&#x27; to &#x27;trunk&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/3]/Interface[Ethernet1/3]/allowed_trunk_vlans: defined &#x27;allowed_trunk_vlans&#x27; as &#x27;3,4,5,8,9&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/2]/Interface[Ethernet1/2]/description: defined &#x27;description&#x27; as &#x27;ESX Host&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/2]/Interface[Ethernet1/2]/duplex: duplex changed &#x27;auto&#x27; to &#x27;full&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/2]/Interface[Ethernet1/2]/mode: mode changed &#x27;access&#x27; to &#x27;trunk&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/2]/Interface[Ethernet1/2]/allowed_trunk_vlans: defined &#x27;allowed_trunk_vlans&#x27; as &#x27;3,4,5,8,9&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/0]/Interface[Ethernet1/0]/description: defined &#x27;description&#x27; as &#x27;ESX Host&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/0]/Interface[Ethernet1/0]/duplex: duplex changed &#x27;auto&#x27; to &#x27;full&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/0]/Interface[Ethernet1/0]/mode: mode changed &#x27;access&#x27; to &#x27;trunk&#x27;
notice: /Stage[main]//Node[dc_sw2]/Esxport[e1/0]/Interface[Ethernet1/0]/allowed_trunk_vlans: defined &#x27;allowed_trunk_vlans&#x27; as &#x27;3,4,5,8,9&#x27;
notice: Finished catalog run in 14.22 seconds
</code></pre>
<h3>my $0.02</h3>
<p>I must say, I&#x27;m very disappointed in this module so far. ¬†It shows great promise and makes a once tedious task relatively effortless to manage, however with the time invested to find out what is and what is not supported, I think it&#x27;s far too early to invest in such a solution. ¬†The idea of setting something like an expect script loose on my kit also worries me. ¬†It&#x27;s much better to have an API or a promise that the input/output the expect script uses won&#x27;t change in a future release then do something unexpected (pun intended there.)</p>
<p>I guess if we were using an OS like Junos we could have <a href="http://www.swarm-logic.com/content/quick-way-configure-interface-ranges-juniper-switches-junos-tips">created apply-groups like this</a>¬†to abstract the configuration in much the same manner, at least down to the switch level. ¬†Very interesting for a new take on managing these things though</p>
<h2>EDIT:</h2>
<p>I&#x27;ve been thinking about this a lot since I posted it.¬† I think I was too harsh on the tool.¬† It seems even Cisco&#x27;s own tools work by ssh&#x27;ing into the box to make their changes.. while not ideal, for these old IOS devices around, it seems to be the accepted thing to do.¬† It&#x27;s exciting times ahead in this space though, I can feel it!</p></div></div></article></div></div></div><script src="/_next/static/chunks/webpack-caf0f53964771028.js" async=""></script><script src="/_next/static/chunks/bce60fc1-e7cb3874f5f47943.js" async=""></script><script src="/_next/static/chunks/488-f907c6837e991d02.js" async=""></script><script src="/_next/static/chunks/main-app-fd28149d965ecf3e.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/2aaf0723e720e8b9-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/42e58f5a516ebb1b-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/media/4e8dfc5aa8742fdc-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/0d26c7c4f71e78d1.css\",{\"as\":\"style\"}]\n0:\"$L5\"\n"])</script><script>self.__next_f.push([1,"6:HL[\"/_next/static/media/4c1c321c249fa2d1-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n7:HL[\"/_next/static/media/8679c800f1e60000-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n8:HL[\"/_next/static/css/99e3bcfff854f17e.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"9:I{\"id\":\"8827\",\"chunks\":[\"272:static/chunks/webpack-caf0f53964771028.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"488:static/chunks/488-f907c6837e991d02.js\"],\"name\":\"\",\"async\":false}\nb:I{\"id\":\"9126\",\"chunks\":[\"272:static/chunks/webpack-caf0f53964771028.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"488:static/chunks/488-f907c6837e991d02.js\"],\"name\":\"\",\"async\":false}\nc:I{\"id\":\"8920\",\"chunks\":[\"920:static/chunks/920-beeca0bfb1d2369e.js\",\"550:static/chunks/550-ecfe52e7b59667b2.js\",\"534:static/"])</script><script>self.__next_f.push([1,"chunks/app/flying/location/[slug]/page-043b33a402eae0f5.js\"],\"name\":\"\",\"async\":false}\nd:I{\"id\":\"558\",\"chunks\":[\"920:static/chunks/920-beeca0bfb1d2369e.js\",\"185:static/chunks/app/layout-33994cd5ee6d865f.js\"],\"name\":\"\",\"async\":false}\nf:I{\"id\":\"4463\",\"chunks\":[\"272:static/chunks/webpack-caf0f53964771028.js\",\"253:static/chunks/bce60fc1-e7cb3874f5f47943.js\",\"488:static/chunks/488-f907c6837e991d02.js\"],\"name\":\"\",\"async\":false}\n10:I{\"id\":\"1010\",\"chunks\":[\"272:static/chunks/webpack-caf0f53964771028.js\",\"253:static/"])</script><script>self.__next_f.push([1,"chunks/bce60fc1-e7cb3874f5f47943.js\",\"488:static/chunks/488-f907c6837e991d02.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"5:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0d26c7c4f71e78d1.css\",\"precedence\":\"next\"}]],[\"$\",\"$L9\",null,{\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/post/2012/ios-with-puppet/\",\"initialTree\":[\"\",{\"children\":[\"(margined)\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"2012/ios-with-puppet\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"2012\\\",\\\"ios-with-puppet\\\"]}\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[\"$La\",[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]],\"globalErrorComponent\":\"$b\",\"notFound\":[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_0ec1f4\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex max-w-full w-full flex-col pt-8 pb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"self-center w-full\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-center text-4xl __className_baad2a\",\"children\":[\"$\",\"$Lc\",null,{\"href\":\"/\",\"children\":\"Scott O'Brien\"}]}],[\"$\",\"$Ld\",null,{}]]}],[\"$\",\"div\",null,{\"className\":\"w-full flex flex-col\",\"id\":\"main-content\",\"children\":[\"$Le\",\"$undefined\",[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]]}]]}]}]}],\"asNotFound\":false,\"children\":[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_0ec1f4\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex max-w-full w-full flex-col pt-8 pb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"self-center w-full\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-center text-4xl __className_baad2a\",\"children\":[\"$\",\"$Lc\",null,{\"href\":\"/\",\"children\":\"Scott O'Brien\"}]}],[\"$\",\"$Ld\",null,{}]]}],[\"$\",\"div\",null,{\"className\":\"w-full flex flex-col\",\"id\":\"main-content\",\"children\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[[\"$\",\"div\",null,{\"className\":\"self-center mt-7 max-w-2xl w-[80%]\",\"children\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(margined)\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(margined)\",\"children\",\"post\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Lf\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(margined)\",\"children\",\"post\",\"children\",[\"slug\",\"2012/ios-with-puppet\",\"c\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L10\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$L11\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":[\\\"2012\\\",\\\"ios-with-puppet\\\"]}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/99e3bcfff854f17e.css\",\"precedence\":\"next\"}]]}],\"segment\":[\"slug\",\"2012/ios-with-puppet\",\"c\"]},\"styles\":[]}],\"segment\":\"post\"},\"styles\":[]}]}],null],\"segment\":\"(margined)\"},\"styles\":[]}]}]]}]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\na:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Scott O'Brien\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"My online creative outlet\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"any\"}]]\n"])</script><script>self.__next_f.push([1,"12:I{\"id\":\"8707\",\"chunks\":[\"707:static/chunks/707-e3070078e72f1aa2.js\",\"417:static/chunks/app/(margined)/recipes/[slug]/page-917a0b4e5c04f36e.js\"],\"name\":\"\",\"async\":false}\n13:I{\"id\":\"2853\",\"chunks\":[\"91:static/chunks/app/flying/flight/[slug]/page-96287e22abdff0cd.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"11:[\"$\",\"article\",null,{\"className\":\"\",\"children\":[\"$\",\"div\",null,{\"className\":\"__className_2e19ce mb-9\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"__className_59b087 text-2xl\",\"children\":\"My experiences of managing a Cisco switch with Puppet\"}],[\"$\",\"div\",null,{\"className\":\"text-xs text-gray-400 italic mb-5\",\"children\":[\"Created: \",\"12/8/2012\"]}],[\"$\",\"$L12\",null,{\"src\":{\"src\":\"/_next/static/media/IOU-Web-Interface-Laboratories.e92325c4.jpg\",\"height\":319,\"width\":507,\"blurDataURL\":\"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAAFAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAf/xAAfEAABAwMFAAAAAAAAAAAAAAABAAIRAwQxEhMhUWH/xAAVAQEBAAAAAAAAAAAAAAAAAAADBP/EABcRAQEBAQAAAAAAAAAAAAAAAAEAEQL/2gAMAwEAAhEDEQA/AKi67qsuNs6S7kTBAwDife0REyGFOdOt/9k=\",\"blurWidth\":8,\"blurHeight\":5},\"alt\":\"Post picture\",\"className\":\"m-auto mb-5\"}],[\"$\",\"div\",null,{\"className\":\"prose lg:prose-lg\",\"children\":[\"$\",\"$L13\",null,{\"code\":\"var Component=(()=\u003e{var h=Object.create;var s=Object.defineProperty;var l=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,w=Object.prototype.hasOwnProperty;var m=(n,e)=\u003e()=\u003e(e||n((e={exports:{}}).exports,e),e.exports),f=(n,e)=\u003e{for(var i in e)s(n,i,{get:e[i],enumerable:!0})},r=(n,e,i,a)=\u003e{if(e\u0026\u0026typeof e==\\\"object\\\"||typeof e==\\\"function\\\")for(let o of u(e))!w.call(n,o)\u0026\u0026o!==i\u0026\u0026s(n,o,{get:()=\u003ee[o],enumerable:!(a=l(e,o))||a.enumerable});return n};var Q=(n,e,i)=\u003e(i=n!=null?h(g(n)):{},r(e||!n||!n.__esModule?s(i,\\\"default\\\",{value:n,enumerable:!0}):i,n)),P=n=\u003er(s({},\\\"__esModule\\\",{value:!0}),n);var d=m((S,c)=\u003e{c.exports=_jsx_runtime});var y={};f(y,{default:()=\u003ev,frontmatter:()=\u003eI});var t=Q(d());var E=\\\"/posts/2012/ios-with-puppet/IOU-Web-Interface-Laboratories-5ERSLRAL.jpg\\\";var I={title:\\\"My experiences of managing a Cisco switch with Puppet\\\",author:\\\"scottyob\\\",type:\\\"post\\\",date:new Date(1354969181e3),url:\\\"/2012/12/08/my-experiences-of-managing-a-cisco-switch-with-puppet/\\\",categories:[\\\"nerd\\\",\\\"networking\\\"],tags:[\\\"Cisco\\\",\\\"IOS\\\",\\\"puppet\\\"],hero:\\\"IOU-Web-Interface-Laboratories.jpg\\\"};function p(n){let e=Object.assign({p:\\\"p\\\",h3:\\\"h3\\\",strong:\\\"strong\\\",a:\\\"a\\\",h4:\\\"h4\\\",pre:\\\"pre\\\",code:\\\"code\\\",h2:\\\"h2\\\"},n.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.p,{children:\\\"One recent pet gripe of mine has been having to add a new VLAN into our datacenter for our vSphere platform. \\\\xA0Not that I trust my DCs switches with puppet just yet, this is a proof of concept post about how we could be using puppet to centrally manage this configuration and push it out across our DC.\\\"}),`\\n`,`\\n`,(0,t.jsx)(e.h3,{children:\\\"Before\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"We've got a pretty basic topology going on in our DC, it's just a VSS with the other switches pretty much being nothing more but layer 2 for the most part. \\\\xA0The dot1q trunk back to the VSS carries all VLANs from our end of row switches. \\\\xA0When we add a new vlan in the DC to trunk to the ESX machines, we would add the VLAN in all the DC switches (not running VTP) then add the vlan to the trunk port on each port patched to the ESX hosts. \\\\xA0(we're not using any link aggregation to the ports connected to the same ESX host, the ESX hosts themselves have their own load balancing method.. If you know any for/against doing it like this please comment and let me know)\\\"}),`\\n`,(0,t.jsx)(e.h3,{children:(0,t.jsx)(e.strong,{children:\\\"Setting up the Puppet lab\\\"})}),`\\n`,(0,t.jsxs)(e.p,{children:[\\\"Introduced in Puppet 2.7 is \\\",(0,t.jsx)(e.a,{href:\\\"http://puppetlabs.com/blog/puppet-network-device-management/\\\",children:\\\"network device management\\\"}),\\\". \\\\xA0This more or less is an expect script to manage interfaces and vlans on IOS devices. \\\\xA0For this lab, we will be using cisco IOU with the following topology\\\"]}),`\\n`,(0,t.jsx)(\\\"img\\\",{src:E}),`\\n`,(0,t.jsx)(e.h4,{children:\\\"Setting up the Devices\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"Ideally, you would have a few puppet nodes that manage a few devices each to spread out the load, for the purposes of this exercise, I created a single vm running Centos6 with both puppet-server and puppet installed. \\\\xA0For this machine to manage the switches, I added the following into the device.conf file\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\\\"language-[root@localhost\\\",children:`[dc_sw1]\\ntype cisco\\nurl telnet://puppet:cisco@10.0.1.131/\\n[dc_sw2]\\ntype cisco\\nurl telnet://puppet:cisco@10.0.1.132/\\n[dc_sw3]\\ntype cisco\\nurl telnet://puppet:cisco@10.0.1.133/\\n[dc_sw4]\\ntype cisco\\nurl telnet://puppet:cisco@10.0.1.134/\\n`})}),`\\n`,(0,t.jsx)(e.h3,{children:\\\"Signing the devices\\\"}),`\\n`,(0,t.jsxs)(e.p,{children:[\\\"To update the devices, you have to run\\\\xA0\\\",(0,t.jsx)(e.strong,{children:\\\"puppet device\\\"}),\\\". \\\\xA0The first time you run it, a certificate will be created that needs to be signed on the puppet master.\\\"]}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\\\"language-[root@localhost\\\",children:`info: starting applying configuration to dc_sw4 at telnet://puppet:cisco@10.0.1.134/\\ninfo: Creating a new SSL key for dc_sw4\\nwarning: peer certificate won't be verified in this SSL session\\ninfo: Caching certificate for ca\\nwarning: peer certificate won't be verified in this SSL session\\nwarning: peer certificate won't be verified in this SSL session\\ninfo: Creating a new SSL certificate request for dc_sw4\\ninfo: Certificate Request fingerprint (md5): E8:A6:35:9D:BF:CE:3D:BC:E0:E4:C2:5B:00:CE:9F:DB\\nwarning: peer certificate won't be verified in this SSL session\\nwarning: peer certificate won't be verified in this SSL session\\nwarning: peer certificate won't be verified in this SSL session\\n`})}),`\\n`,(0,t.jsx)(e.p,{children:\\\"so we'll need to sign our devices\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\\\"language-[root@localhost\\\",children:`notice: Signed certificate request for dc_sw4\\nnotice: Removing file Puppet::SSL::CertificateRequest dc_sw4 at '/var/lib/puppet/ssl/ca/requests/dc_sw4.pem'\\n`})}),`\\n`,(0,t.jsx)(e.h3,{children:\\\"Setting up the switches for Puppet\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"If you look up to the device configuration file, we need to create a local user for puppet to log into the switch (remember, it acts much like an expect script)\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\\\"language-username\\\",children:`line vty 0 4\\nprivilege level 15\\npassword cisco\\nlogin local\\ntransport input all\\n!\\n`})}),`\\n`,(0,t.jsx)(e.h3,{children:\\\"The Configuration\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"so with no more ado, we can easily simply abstract the behaviour of these ports using puppet syntax \\\\u{1F642}\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\\\"language-define\\\",children:`\\ninterface {\\n\\\"\\\\${port}\\\":\\nmode =\u003e trunk,\\nduplex =\u003e full,\\ndescription =\u003e \\\"ESX Host\\\",\\nallowed_trunk_vlans =\u003e \\\"3,4,5,8,9\\\"\\n}\\n\\n}\\n\\nnode \\\"dc_sw1\\\" {\\n\\nesxport { 'e0/2': port =\u003e 'Ethernet0/2' }\\nesxport { 'e0/3': port =\u003e 'Ethernet0/3' }\\n\\n}\\n\\nnode \\\"dc_sw2\\\" {\\n\\nesxport { 'e1/0': port =\u003e 'Ethernet1/0' }\\nesxport { 'e1/1': port =\u003e 'Ethernet1/1' }\\nesxport { 'e1/2': port =\u003e 'Ethernet1/2' }\\nesxport { 'e1/3': port =\u003e 'Ethernet1/3' }\\n\\n}\\n`})}),`\\n`,(0,t.jsx)(e.h4,{children:\\\"The Ugly\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"A lot of the states don't yet seem to be supported by this module. \\\\xA0This means even the default trunk mode of dynamic desirable will cause issues when Puppet is pulling device information and you'll have to manually specify \\\\u201Cswitchport trunk encapsulation dot1q\\\\u201D and \\\\u201Cswitchport mode access\\\\u201D before setting puppet free on the devices.\\\"}),`\\n`,(0,t.jsx)(e.h4,{children:\\\"Results\\\"}),`\\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\\\"language-[root@localhost\\\",children:`info: starting applying configuration to dc_sw4 at telnet://puppet:cisco@10.0.1.134/\\ninfo: Caching catalog for dc_sw4\\ninfo: Applying configuration version '1355007108'\\nnotice: Finished catalog run in 0.20 seconds\\ninfo: starting applying configuration to dc_sw3 at telnet://puppet:cisco@10.0.1.133/\\ninfo: Caching catalog for dc_sw3\\ninfo: Applying configuration version '1355007108'\\nnotice: Finished catalog run in 0.21 seconds\\ninfo: starting applying configuration to dc_sw2 at telnet://puppet:cisco@10.0.1.132/\\ninfo: Caching catalog for dc_sw2\\ninfo: Applying configuration version '1355007108'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/1]/Interface[Ethernet1/1]/description: defined 'description' as 'ESX Host'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/1]/Interface[Ethernet1/1]/duplex: duplex changed 'auto' to 'full'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/1]/Interface[Ethernet1/1]/mode: mode changed 'access' to 'trunk'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/1]/Interface[Ethernet1/1]/allowed_trunk_vlans: defined 'allowed_trunk_vlans' as '3,4,5,8,9'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/3]/Interface[Ethernet1/3]/description: defined 'description' as 'ESX Host'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/3]/Interface[Ethernet1/3]/duplex: duplex changed 'auto' to 'full'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/3]/Interface[Ethernet1/3]/mode: mode changed 'access' to 'trunk'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/3]/Interface[Ethernet1/3]/allowed_trunk_vlans: defined 'allowed_trunk_vlans' as '3,4,5,8,9'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/2]/Interface[Ethernet1/2]/description: defined 'description' as 'ESX Host'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/2]/Interface[Ethernet1/2]/duplex: duplex changed 'auto' to 'full'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/2]/Interface[Ethernet1/2]/mode: mode changed 'access' to 'trunk'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/2]/Interface[Ethernet1/2]/allowed_trunk_vlans: defined 'allowed_trunk_vlans' as '3,4,5,8,9'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/0]/Interface[Ethernet1/0]/description: defined 'description' as 'ESX Host'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/0]/Interface[Ethernet1/0]/duplex: duplex changed 'auto' to 'full'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/0]/Interface[Ethernet1/0]/mode: mode changed 'access' to 'trunk'\\nnotice: /Stage[main]//Node[dc_sw2]/Esxport[e1/0]/Interface[Ethernet1/0]/allowed_trunk_vlans: defined 'allowed_trunk_vlans' as '3,4,5,8,9'\\nnotice: Finished catalog run in 14.22 seconds\\n`})}),`\\n`,(0,t.jsx)(e.h3,{children:\\\"my $0.02\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"I must say, I'm very disappointed in this module so far. \\\\xA0It shows great promise and makes a once tedious task relatively effortless to manage, however with the time invested to find out what is and what is not supported, I think it's far too early to invest in such a solution. \\\\xA0The idea of setting something like an expect script loose on my kit also worries me. \\\\xA0It's much better to have an API or a promise that the input/output the expect script uses won't change in a future release then do something unexpected (pun intended there.)\\\"}),`\\n`,(0,t.jsxs)(e.p,{children:[\\\"I guess if we were using an OS like Junos we could have \\\",(0,t.jsx)(e.a,{href:\\\"http://www.swarm-logic.com/content/quick-way-configure-interface-ranges-juniper-switches-junos-tips\\\",children:\\\"created apply-groups like this\\\"}),\\\"\\\\xA0to abstract the configuration in much the same manner, at least down to the switch level. \\\\xA0Very interesting for a new take on managing these things though\\\"]}),`\\n`,(0,t.jsx)(e.h2,{children:\\\"EDIT:\\\"}),`\\n`,(0,t.jsx)(e.p,{children:\\\"I've been thinking about this a lot since I posted it.\\\\xA0 I think I was too harsh on the tool.\\\\xA0 It seems even Cisco's own tools work by ssh'ing into the box to make their changes.. while not ideal, for these old IOS devices around, it seems to be the accepted thing to do.\\\\xA0 It's exciting times ahead in this space though, I can feel it!\\\"})]})}function k(n={}){let{wrapper:e}=n.components||{};return e?(0,t.jsx)(e,Object.assign({},n,{children:(0,t.jsx)(p,n)})):p(n)}var v=k;return P(y);})();\\n;return Component;\"}]}]]}]}]\n"])</script></body></html>