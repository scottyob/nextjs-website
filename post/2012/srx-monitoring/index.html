<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="preload" as="font" href="/_next/static/media/42e58f5a516ebb1b-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/d45575ed0ad4f563-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/8679c800f1e60000-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/af1939b13935fec8-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/3f39c10fbbbc2013.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/d699b3284dd0f0c8.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/e1665b43251c86eb.css" data-precedence="next"/><link rel="preload" href="/_next/static/chunks/webpack-1b9985338a73b6a9.js" as="script"/><link rel="preload" href="/_next/static/chunks/fd9d1056-f562485b1666a0a3.js" as="script"/><link rel="preload" href="/_next/static/chunks/596-5b64dbf019a905f5.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-app-c71b577ad5f96a17.js" as="script"/><title>Scott O&#x27;Brien</title><meta name="description" content="My online creative outlet"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_e66fe9"><div class="flex max-w-full w-full flex-col pt-8 pb-8"><div class="self-center w-full"><h1 class="text-center text-4xl __className_31da3a"><a href="/">Scott O&#x27;Brien</a></h1><ul class="flex flex-wrap justify-center text-gray-400 italic pt-3 mb-8 max-w-2xl w-[80%] m-auto [&amp;&gt;li]:ml-3 [&amp;&gt;li]:mr-3 [&amp;_svg]:inline [&amp;_svg]:mr-1 __className_7febbd"><li class="transition group duration-300 whitespace-nowrap"><a href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" version="1.1" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 10l2-1 7-7-1-1-7 7-1 2zM4.52 13.548c-0.494-1.043-1.026-1.574-2.069-2.069l1.548-4.262 2-1.217 6-6h-3l-6 6-3 10 10-3 6-6v-3l-6 6-1.217 2z"></path></svg>Writings/Projects</a><span class="block group-hover:max-w-[75%] m-auto transition-all duration-500 h-0.5 max-w-[85%] bg-orange-500"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/about/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" version="1.1" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9 1.5c0 0.828-0.672 1.5-1.5 1.5s-1.5-0.672-1.5-1.5c0-0.828 0.672-1.5 1.5-1.5s1.5 0.672 1.5 1.5z"></path><path d="M9 4h-3c-0.552 0-1 0.448-1 1v5h1v6h1.25v-6h0.5v6h1.25v-6h1v-5c0-0.552-0.448-1-1-1z"></path></svg>About</a><span class="block group-hover:max-w-[75%] m-auto transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/bucketlist/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"></path><path d="M5 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 5 8zm0-2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-1-5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zM4 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm0 2.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"></path></svg>Bucket List</a><span class="block group-hover:max-w-[75%] m-auto transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/recipes/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M151.7 16.73s-20.6 14.12-22 25.18c-1.4 11.33 17.6 19.24 15.6 30.48-1.3 7.43-16.6 15.38-16.6 15.38s38.7-3.36 42.3-18.3c2.9-11.82-19.8-16.61-23-28.35-2.1-7.94 3.7-24.39 3.7-24.39zm214.4 4.89s-24.8 13.58-24.9 25.45c-.1 7.24 14.4 8.67 14.8 15.9.5 8.56-15.3 20.68-15.3 20.68s33.6-3.81 38.1-16.97c2.7-7.77-9.4-13.81-11.6-21.73-2.1-7.5-1.1-23.33-1.1-23.33zm-106.9.26s-26.9 13.75-24.9 25.45c1.4 7.93 20.6 2.62 21.7 10.6 1.7 13.01-29.6 25.98-29.6 25.98s56.5-1.44 58.8-22.27c1.1-9.88-20-7.79-24.9-16.43-3.9-6.77-1.1-23.33-1.1-23.33zM48 105.6v18h416v-18zm16 37c-14.48 86.9 16.9 138.1 58.6 168.2-3.6-24.8-14.1-49.1-35.06-72.2 39.96 10.5 71.36 48.8 85.36 87.2 2.3-18.8 2.3-27.5 19.5-44.2-3.1 24.8 11.2 26.5 21.2 23.4 25.3-7.9 35.6-39.5 10.6-78.9 47.6 22.7 48.3 48.4 56.3 83.7-2.4-33.2 24.3-46.5 43.7-34-45.1 22.7-8.2 42.2 6.9 47 40 12.8 70-46.3 87.2-91 4.7 19.8.8 39.7-6.5 59.5C441.4 260 459.7 213 448 142.6zm184.3 175.2L75 417.5c2.7 18.4 9 34.4 18.8 48.5l92-44.1-78.7 59.9c3.4 3.4 7.1 6.6 11 9.7l74.7-42.9c0-.7-.1-1.5-.1-2.2 0-37.2 30.5-67.6 67.8-67.6 10.6 0 20.6 2.4 29.5 6.7-2.4-13.4-7.3-27.1-14.8-39.2l-94.9 40.1 82.5-56.5c-4.4-4.5-9.2-8.6-14.5-12.1zm58.9 57.6c1.6 7.2 2.6 14.4 3 21.4l.2 3.9c11.1 12 17.9 28.1 17.9 45.7 0 7.8-1.3 15.3-3.8 22.2l91.4 24.4c4.6-6.3 8.6-12.8 11.8-19.4l-63.1-24.7 70.1 6.9c.9-3 1.6-5.9 2.2-8.9l-97.1-34.3 99.2 15.5c.2-5.8-.1-11.7-.8-17.7zm-46.7 22.1c-27.2 0-49.1 21.8-49.1 48.9 0 27.1 21.9 48.9 49.1 48.9 27.3 0 49.2-21.8 49.2-48.9 0-27.1-21.9-48.9-49.2-48.9zm-4.9 11.8c43.8 0 58.4 71.6 0 71.6 26.6-23.1 29.8-46.9 0-71.6zm.2 9.8c-21.6 17.9-19.3 35.2 0 52-42.4 0-31.8-52 0-52z"></path></svg>Cooking</a><span class="block group-hover:max-w-[75%] m-auto transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/climbing/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="m90.67 25 96.83 144.3-1.5-24.6L105.7 25zM131 25l156.2 123.1-5-41.8 121.5 129.5L435 487h51.7V25zm70.5 98.2 3.6 61.8c-5 7.4-24.1 32.5-56.9 36.8-4.1.5-7.2 4-7.2 8.2 0 0-.8 37.2 45.7 83.1l34.7-55.7c-7-7.3-14-16.5-21.5-28.7l27.6-30.1c1.8-1.9 2.5-4.4 2.1-7L218 121.4c-2.7-11.2-16.9-7.5-16.5 1.8zm-69.8 27c-9.2 0-16.9 3.8-20.8 10.3-7.1 11.8-.1 29.1 15.8 38.6s34.5 7.4 41.5-4.5-.1-29.1-15.9-38.5c-6.5-3.8-13.7-5.9-20.6-5.9zm155.5 76.2-42.6 32.7-12.1 80.1c12.4 3.1 25.4 4 38.3 2.2l22.5-3.1 45.9 50.4c1.9 2 4.6 3 7.3 2.6l29-4c11.2-3.3 7.2-16.5-1.4-16.6l-21.4.7-30.6-66.1c-1.1-2.2-3-3.8-5.3-4.5l-38.7-11.2 22.6-19.4L353 289c4.7 1.5 9.3-1.1 10.8-5.3l10.5-34c1.7-11.3-11.7-13.6-15.5-6l-8.1 17.1-53.9-34.8c-3.2-1.8-6.8-1.5-9.6.4zM223.9 285l-24.3 38.9c5.3 3.8 11 7.1 16.9 9.7zm19 74.3L274.4 487h12.8l-31.4-127.4c-4.3.1-8.6 0-12.9-.3z"></path></svg>Climbing</a><span class="block group-hover:max-w-[75%] m-auto transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li><li class="transition group duration-300 whitespace-nowrap"><a href="/flying/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M487 37.1C396.4 53.23 292 95.28 207.5 140 163 163.6 124 187.8 95.39 209.2 81.08 220 69.36 230 60.93 238.6c-8.43 8.7-13.38 16.3-14.65 20.3-9.04 28.7-3.42 57.7 1.73 84.7 9.55 50.4-3.23 88.9-22.98 126.3 25.24-5.7 45.36-19.8 57-47 8.47-19.8 9.13-37 11.43-57.6 2.3-20.6 6.45-44.2 22.44-73.2l.2-.4.2-.4c8.8-12.6 26.2-22.2 50-33.4 23.7-11.2 53.6-23 86-35.1 63.8-23.8 137.2-48.7 190.1-71.3 20-30.1 34-74.24 44.6-114.4zm-55 138.2c-51.7 21-116.6 43.1-173.5 64.3-32.2 12-61.8 23.7-84.6 34.5-22.6 10.7-38.5 21.6-42.6 27.2-6.8 12.3-11.1 23.2-14 33.3 83.4-6.5 195.3-31.8 271.3-66.6 27.4-29.7 36.9-59.7 43.4-92.7zm-58 118.8c-79 32.2-182 53.3-260.8 58.6-.9 5-1.5 9.8-2 14.6-.4 3.5-.7 7.1-1.1 10.6 72.4 7.5 136.3 4 206.2-6.5 32.6-22.5 49.8-49.6 57.7-77.3zm-78.4 98.2c-62.3 8.1-121.6 10.2-187.6 3.4-.7 4.5-1.6 9-2.7 13.6 35.9 19.2 98.1 25.8 140.7 24.6 30.2-12.4 41.5-24.8 49.6-41.6zM99.78 426.7c-1.15 2.1-3.14 6.7-4.21 8.9 14.03 20.2 48.73 32.2 88.43 39.3 21.2-8 28.3-15.5 36.5-23-39.7-1.1-86.7-7.7-120.7-25.2z"></path></svg>Flying</a><span class="block group-hover:max-w-[75%] m-auto transition-all duration-500 h-0.5 max-w-0 bg-orange-50 group-hover:bg-orange-400"></span></li></ul></div><div class="w-full flex flex-col" id="main-content"><div class="self-center mt-7 max-w-2xl w-[80%]"><article class=""><div class="__className_12746b mb-9"><h2 class="__className_df02b7 text-2xl">Monitoring SRX Chassis Cluster</h2><div class="text-xs text-gray-400 italic mb-5">Created: <span>7/9/2012, 4:44:35 AM</span></div><div class="prose lg:prose-lg"><p>Just finishing off a few things at work this week.  We&#x27;ve got a few sites around the place where we have HA internet powered by two Juniper SRX100&#x27;s.  The Two SRX100&#x27;s operate in a Chassis Cluster and peer with our ISP using BGP across both active/passive devices.</p>
<!-- -->
<p>Below is a little Nagios check script that I wrote to hook into our in-house Nagios monitoring platform.  It makes sure the chassis cluster has not failed over operating in a degraded state, and makes sure that there are two BGP peers connected.</p>
<p>NOTE:  I was aiming for simplicity in this setup, if you&#x27;ve got a bigger environment or require instant notifications you might wish to set up snmp traps to get instant notifications.</p>
<pre><code class="language-#!/bin/bash">
# Bash script to check the status of a SRX cluster.
#  Works by SSHing into cluster to check &quot;show chassis cluster status&quot; command and SNMP walking to make sure BGP peers
#  are both in a connected state

STATE_OK=0
STATE_WARNING=1
STATE_CRITICAL=2
STATE_UNKNOWN=3

clusterAddress=$1
privateKey=$2
clusterStatus=`ssh nagios@$clusterAddress -i $privateKey &quot;show chassis cluster status&quot;`

declare -i primaryCount
declare -i secondaryCount
declare -i failoverCount
declare -i activeBgpPeers

activeBgpPeers=`snmpwalk -Os -c public -v 1 $clusterAddress .1.3.6.1.2.1.15.3.1.2 | grep &quot;INTEGER: 6&quot; | wc -l`
primaryCount=`echo &quot;$clusterStatus&quot; | grep primary | wc -l`
secondaryCount=`echo &quot;$clusterStatus&quot; | grep secondary | wc -l`
failoverCount=`echo &quot;$clusterStatus&quot; | grep &quot;Failover count: 0&quot; | wc -l`

if [ $primaryCount -ne 2 ]
then
  echo &quot;No two primary redundancy groups&quot;
  echo &quot;$clusterStatus&quot;
  exit $STATE_CRITICAL
fi

if [ $secondaryCount -ne 2 ]
then
  echo &quot;No two secondary redundancy groups&quot;
  echo &quot;$clusterStatus&quot;
  exit $STATE_CRITICAL
fi

if [ $failoverCount -ne 2 ]
then
  echo &quot;SRX has fallen over on a redundancy group&quot;
  echo &quot;$clusterStatus&quot;
  exit $STATE_WARNING
fi

if [ $activeBgpPeers -ne 2 ]
then
  echo &quot;NOT 2 Active BGP Peers&quot;
  exit $STATE_CRITICAL
fi

echo &quot;OK, 2 peers.  OK: Chassis Cluster status OK&quot;
echo &quot;$clusterStatus&quot;
exit $STATE_OK
</code></pre>
<p> </p></div></div></article></div></div></div><script src="/_next/static/chunks/webpack-1b9985338a73b6a9.js" async=""></script><script src="/_next/static/chunks/fd9d1056-f562485b1666a0a3.js" async=""></script><script src="/_next/static/chunks/596-5b64dbf019a905f5.js" async=""></script><script src="/_next/static/chunks/main-app-c71b577ad5f96a17.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/3f39c10fbbbc2013.css\",{\"as\":\"style\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/media/42e58f5a516ebb1b-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n5:HL[\"/_next/static/media/d45575ed0ad4f563-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n6:HL[\"/_next/static/css/d699b3284dd0f0c8.css\",{\"as\":\"style\"}]\n7:HL[\"/_next/static/media/8679c800f1e60000-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n8:HL[\"/_next/static/media/af1939b13935fec8-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n9:HL["])</script><script>self.__next_f.push([1,"\"/_next/static/css/e1665b43251c86eb.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"a:I{\"id\":7948,\"chunks\":[\"272:static/chunks/webpack-1b9985338a73b6a9.js\",\"971:static/chunks/fd9d1056-f562485b1666a0a3.js\",\"596:static/chunks/596-5b64dbf019a905f5.js\"],\"name\":\"default\",\"async\":false}\nc:I{\"id\":6628,\"chunks\":[\"272:static/chunks/webpack-1b9985338a73b6a9.js\",\"971:static/chunks/fd9d1056-f562485b1666a0a3.js\",\"596:static/chunks/596-5b64dbf019a905f5.js\"],\"name\":\"GlobalError\",\"async\":false}\nd:I{\"id\":7767,\"chunks\":[\"272:static/chunks/webpack-1b9985338a73b6a9.js\",\"971:static/chunks/fd9d1056-f562485b1666"])</script><script>self.__next_f.push([1,"a0a3.js\",\"596:static/chunks/596-5b64dbf019a905f5.js\"],\"name\":\"default\",\"async\":false}\ne:I{\"id\":7920,\"chunks\":[\"272:static/chunks/webpack-1b9985338a73b6a9.js\",\"971:static/chunks/fd9d1056-f562485b1666a0a3.js\",\"596:static/chunks/596-5b64dbf019a905f5.js\"],\"name\":\"default\",\"async\":false}\nf:I{\"id\":6685,\"chunks\":[\"685:static/chunks/685-bd04e00715de5b93.js\",\"222:static/chunks/222-0319df8e2b26098e.js\",\"982:static/chunks/982-07d375c9d37b134d.js\",\"46:static/chunks/app/(navbar)/(margined)/page-8bf83f1785e07527.js\"],\"na"])</script><script>self.__next_f.push([1,"me\":\"\",\"async\":false}\n10:I{\"id\":2179,\"chunks\":[\"724:static/chunks/358ff52d-5af8921f222f7c20.js\",\"122:static/chunks/e416a3ff-e7ae2f31ae45a9d1.js\",\"447:static/chunks/00cbbcb7-5522c112e5f40d45.js\",\"685:static/chunks/685-bd04e00715de5b93.js\",\"713:static/chunks/app/(navbar)/layout-7ab2b37aff2ff4fb.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3f39c10fbbbc2013.css\",\"precedence\":\"next\"}]],[\"$\",\"$La\",null,{\"buildId\":\"VT6HUrkbdq8xqNXNA8sfL\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/post/2012/srx-monitoring/\",\"initialTree\":[\"\",{\"children\":[\"(navbar)\",{\"children\":[\"(margined)\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"2012/srx-monitoring\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"2012\\\",\\\"srx-monitoring\\\"]}\",{}]}]}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":\"$Lb\",\"globalErrorComponent\":\"$c\",\"children\":[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[[\"$\",\"body\",null,{\"className\":\"__className_e66fe9\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex max-w-full w-full flex-col pt-8 pb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"self-center w-full\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-center text-4xl __className_31da3a\",\"children\":[\"$\",\"$Lf\",null,{\"href\":\"/\",\"children\":\"Scott O'Brien\"}]}],[\"$\",\"$L10\",null,{}]]}],[\"$\",\"div\",null,{\"className\":\"w-full flex flex-col\",\"id\":\"main-content\",\"children\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(navbar)\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[[\"$\",\"div\",null,{\"className\":\"self-center mt-7 max-w-2xl w-[80%]\",\"children\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(navbar)\",\"children\",\"(margined)\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(navbar)\",\"children\",\"(margined)\",\"children\",\"post\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Ld\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(navbar)\",\"children\",\"(margined)\",\"children\",\"post\",\"children\",[\"slug\",\"2012/srx-monitoring\",\"c\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$L11\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":[\\\"2012\\\",\\\"srx-monitoring\\\"]}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/e1665b43251c86eb.css\",\"precedence\":\"next\"}]]}],\"segment\":[\"slug\",\"2012/srx-monitoring\",\"c\"]},\"styles\":[]}],\"segment\":\"post\"},\"styles\":[]}]}],null],\"segment\":\"(margined)\"},\"styles\":[]}]}]]}]}],null],\"segment\":\"(navbar)\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/d699b3284dd0f0c8.css\",\"precedence\":\"next\"}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Scott O'Brien\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"My online creative outlet\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"any\"}],[\"$\",\"meta\",\"5\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"12:I{\"id\":8248,\"chunks\":[\"222:static/chunks/222-0319df8e2b26098e.js\",\"982:static/chunks/982-07d375c9d37b134d.js\",\"344:static/chunks/app/(navbar)/(margined)/post/[...slug]/page-98143d1a69f07e79.js\"],\"name\":\"\",\"async\":false}\n13:I{\"id\":9098,\"chunks\":[\"222:static/chunks/222-0319df8e2b26098e.js\",\"982:static/chunks/982-07d375c9d37b134d.js\",\"344:static/chunks/app/(navbar)/(margined)/post/[...slug]/page-98143d1a69f07e79.js\"],\"name\":\"\",\"async\":false}\n14:Tddc,"])</script><script>self.__next_f.push([1,"var Component=(()=\u003e{var l=Object.create;var o=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var m=(t,e)=\u003e()=\u003e(e||t((e={exports:{}}).exports,e),e.exports),S=(t,e)=\u003e{for(var s in e)o(t,s,{get:e[s],enumerable:!0})},i=(t,e,s,a)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let r of d(e))!f.call(t,r)\u0026\u0026r!==s\u0026\u0026o(t,r,{get:()=\u003ee[r],enumerable:!(a=p(e,r))||a.enumerable});return t};var w=(t,e,s)=\u003e(s=t!=null?l(g(t)):{},i(e||!t||!t.__esModule?o(s,\"default\",{value:t,enumerable:!0}):s,t)),T=t=\u003ei(o({},\"__esModule\",{value:!0}),t);var u=m((N,c)=\u003e{c.exports=_jsx_runtime});var v={};S(v,{default:()=\u003e$,frontmatter:()=\u003eC});var n=w(u()),C={title:\"Monitoring SRX Chassis Cluster\",author:\"scottyob\",type:\"post\",date:new Date(1341809075e3),url:\"/2012/07/09/monitoring-srx-chassis-cluster/\",categories:[\"nerd\"],tags:[\"Juniper\",\"Nagios\",\"SNMP\",\"SRX\"]};function h(t){let e=Object.assign({p:\"p\",pre:\"pre\",code:\"code\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:\"Just finishing off a few things at work this week. \\xA0We've got a few sites around the place where we have HA internet powered by two Juniper SRX100's. \\xA0The Two SRX100's operate in a Chassis Cluster and peer with our ISP using BGP across both active/passive devices.\"}),`\n`,`\n`,(0,n.jsx)(e.p,{children:\"Below is a little Nagios check script that I wrote to hook into our in-house Nagios monitoring platform. \\xA0It makes sure the chassis cluster has not failed over operating in a degraded state, and makes sure that there are two BGP peers connected.\"}),`\n`,(0,n.jsx)(e.p,{children:\"NOTE: \\xA0I was aiming for simplicity in this setup, if you've got a bigger environment or require instant notifications you might wish to set up snmp traps to get instant notifications.\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-#!/bin/bash\",children:`\n# Bash script to check the status of a SRX cluster.\n#  Works by SSHing into cluster to check \"show chassis cluster status\" command and SNMP walking to make sure BGP peers\n#  are both in a connected state\n\nSTATE_OK=0\nSTATE_WARNING=1\nSTATE_CRITICAL=2\nSTATE_UNKNOWN=3\n\nclusterAddress=$1\nprivateKey=$2\nclusterStatus=\\`ssh nagios@$clusterAddress -i $privateKey \"show chassis cluster status\"\\`\n\ndeclare -i primaryCount\ndeclare -i secondaryCount\ndeclare -i failoverCount\ndeclare -i activeBgpPeers\n\nactiveBgpPeers=\\`snmpwalk -Os -c public -v 1 $clusterAddress .1.3.6.1.2.1.15.3.1.2 | grep \"INTEGER: 6\" | wc -l\\`\nprimaryCount=\\`echo \"$clusterStatus\" | grep primary | wc -l\\`\nsecondaryCount=\\`echo \"$clusterStatus\" | grep secondary | wc -l\\`\nfailoverCount=\\`echo \"$clusterStatus\" | grep \"Failover count: 0\" | wc -l\\`\n\nif [ $primaryCount -ne 2 ]\nthen\n  echo \"No two primary redundancy groups\"\n  echo \"$clusterStatus\"\n  exit $STATE_CRITICAL\nfi\n\nif [ $secondaryCount -ne 2 ]\nthen\n  echo \"No two secondary redundancy groups\"\n  echo \"$clusterStatus\"\n  exit $STATE_CRITICAL\nfi\n\nif [ $failoverCount -ne 2 ]\nthen\n  echo \"SRX has fallen over on a redundancy group\"\n  echo \"$clusterStatus\"\n  exit $STATE_WARNING\nfi\n\nif [ $activeBgpPeers -ne 2 ]\nthen\n  echo \"NOT 2 Active BGP Peers\"\n  exit $STATE_CRITICAL\nfi\n\necho \"OK, 2 peers.  OK: Chassis Cluster status OK\"\necho \"$clusterStatus\"\nexit $STATE_OK\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"\\xA0\"})]})}function y(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(h,t)})):h(t)}var $=y;return T(v);})();\n;return Component;"])</script><script>self.__next_f.push([1,"11:[\"$\",\"article\",null,{\"className\":\"\",\"children\":[\"$\",\"div\",null,{\"className\":\"__className_12746b mb-9\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"__className_df02b7 text-2xl\",\"children\":\"Monitoring SRX Chassis Cluster\"}],[\"$\",\"div\",null,{\"className\":\"text-xs text-gray-400 italic mb-5\",\"children\":[\"Created: \",[\"$\",\"$L12\",null,{\"date\":\"$D2012-07-09T04:44:35.000Z\"}]]}],\"$undefined\",[\"$\",\"div\",null,{\"className\":\"prose lg:prose-lg\",\"children\":[\"$\",\"$L13\",null,{\"code\":\"$14\"}]}]]}]}]\n"])</script></body></html>