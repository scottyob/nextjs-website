1:HL["/_next/static/css/8a1e8ec2da824aa2.css",{"as":"style"}]
0:["qM5d7cw-vDbPGZohIedvu",[[["",{"children":["(navbar)",{"children":["(margined)",{"children":["post",{"children":[["slug","2012/srx-monitoring","c"],{"children":["__PAGE__?{\"slug\":[\"2012\",\"srx-monitoring\"]}",{}]}]}]}]}]},"$undefined","$undefined",true],"$L2",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/8a1e8ec2da824aa2.css","precedence":"next"}]],"$L3"]]]]
4:HL["/_next/static/media/2aaf0723e720e8b9-s.p.woff2",{"as":"font","type":"font/woff2"}]
5:HL["/_next/static/media/42e58f5a516ebb1b-s.p.woff2",{"as":"font","type":"font/woff2"}]
6:HL["/_next/static/media/4e8dfc5aa8742fdc-s.p.woff2",{"as":"font","type":"font/woff2"}]
7:HL["/_next/static/css/c2c1ea965511607d.css",{"as":"style"}]
8:HL["/_next/static/media/8679c800f1e60000-s.p.woff2",{"as":"font","type":"font/woff2"}]
9:HL["/_next/static/media/af1939b13935fec8-s.p.woff2",{"as":"font","type":"font/woff2"}]
a:HL["/_next/static/css/e1665b43251c86eb.css",{"as":"style"}]
b:I{"id":7767,"chunks":["272:static/chunks/webpack-6a94f4f450a79057.js","971:static/chunks/fd9d1056-f562485b1666a0a3.js","596:static/chunks/596-5b64dbf019a905f5.js"],"name":"default","async":false}
c:I{"id":7920,"chunks":["272:static/chunks/webpack-6a94f4f450a79057.js","971:static/chunks/fd9d1056-f562485b1666a0a3.js","596:static/chunks/596-5b64dbf019a905f5.js"],"name":"default","async":false}
d:I{"id":6685,"chunks":["685:static/chunks/685-a0750907e0c935bc.js","222:static/chunks/222-0c303d3189115893.js","982:static/chunks/982-07d375c9d37b134d.js","46:static/chunks/app/(navbar)/(margined)/page-6e97965ff90afede.js"],"name":"","async":false}
e:I{"id":2179,"chunks":["724:static/chunks/358ff52d-5af8921f222f7c20.js","122:static/chunks/e416a3ff-be1b889799c50168.js","447:static/chunks/00cbbcb7-5522c112e5f40d45.js","685:static/chunks/685-a0750907e0c935bc.js","713:static/chunks/app/(navbar)/layout-e1a28f5172e21563.js"],"name":"","async":false}
2:[["$","html",null,{"lang":"en","children":["$","$Lb",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Lc",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":[["$","body",null,{"className":"__className_20951f","children":["$","div",null,{"className":"flex max-w-full w-full flex-col pt-8 pb-8","children":[["$","div",null,{"className":"self-center w-full","children":[["$","h1",null,{"className":"text-center text-4xl __className_31da3a","children":["$","$Ld",null,{"href":"/","children":"Scott O'Brien"}]}],["$","$Le",null,{}]]}],["$","div",null,{"className":"w-full flex flex-col","id":"main-content","children":["$","$Lb",null,{"parallelRouterKey":"children","segmentPath":["children","(navbar)","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Lc",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":[["$","div",null,{"className":"self-center mt-7 max-w-2xl w-[80%]","children":["$","$Lb",null,{"parallelRouterKey":"children","segmentPath":["children","(navbar)","children","(margined)","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Lc",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$Lb",null,{"parallelRouterKey":"children","segmentPath":["children","(navbar)","children","(margined)","children","post","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Lc",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$Lb",null,{"parallelRouterKey":"children","segmentPath":["children","(navbar)","children","(margined)","children","post","children",["slug","2012/srx-monitoring","c"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$Lc",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$Lf",null],"segment":"__PAGE__?{\"slug\":[\"2012\",\"srx-monitoring\"]}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/e1665b43251c86eb.css","precedence":"next"}]]}],"segment":["slug","2012/srx-monitoring","c"]},"styles":[]}],"segment":"post"},"styles":[]}]}],null],"segment":"(margined)"},"styles":[]}]}]]}]}],null],"segment":"(navbar)"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/c2c1ea965511607d.css","precedence":"next"}]]}]}],null]
3:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Scott O'Brien"}],["$","meta","2",{"name":"description","content":"My online creative outlet"}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}],["$","meta","5",{"name":"next-size-adjust"}]]
10:I{"id":8248,"chunks":["222:static/chunks/222-0c303d3189115893.js","982:static/chunks/982-07d375c9d37b134d.js","344:static/chunks/app/(navbar)/(margined)/post/[...slug]/page-dd011dba93e6ca3b.js"],"name":"","async":false}
11:I{"id":9098,"chunks":["222:static/chunks/222-0c303d3189115893.js","982:static/chunks/982-07d375c9d37b134d.js","344:static/chunks/app/(navbar)/(margined)/post/[...slug]/page-dd011dba93e6ca3b.js"],"name":"","async":false}
12:Tddc,var Component=(()=>{var l=Object.create;var o=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var m=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),S=(t,e)=>{for(var s in e)o(t,s,{get:e[s],enumerable:!0})},i=(t,e,s,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of d(e))!f.call(t,r)&&r!==s&&o(t,r,{get:()=>e[r],enumerable:!(a=p(e,r))||a.enumerable});return t};var w=(t,e,s)=>(s=t!=null?l(g(t)):{},i(e||!t||!t.__esModule?o(s,"default",{value:t,enumerable:!0}):s,t)),T=t=>i(o({},"__esModule",{value:!0}),t);var u=m((N,c)=>{c.exports=_jsx_runtime});var v={};S(v,{default:()=>$,frontmatter:()=>C});var n=w(u()),C={title:"Monitoring SRX Chassis Cluster",author:"scottyob",type:"post",date:new Date(1341809075e3),url:"/2012/07/09/monitoring-srx-chassis-cluster/",categories:["nerd"],tags:["Juniper","Nagios","SNMP","SRX"]};function h(t){let e=Object.assign({p:"p",pre:"pre",code:"code"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:"Just finishing off a few things at work this week. \xA0We've got a few sites around the place where we have HA internet powered by two Juniper SRX100's. \xA0The Two SRX100's operate in a Chassis Cluster and peer with our ISP using BGP across both active/passive devices."}),`
`,`
`,(0,n.jsx)(e.p,{children:"Below is a little Nagios check script that I wrote to hook into our in-house Nagios monitoring platform. \xA0It makes sure the chassis cluster has not failed over operating in a degraded state, and makes sure that there are two BGP peers connected."}),`
`,(0,n.jsx)(e.p,{children:"NOTE: \xA0I was aiming for simplicity in this setup, if you've got a bigger environment or require instant notifications you might wish to set up snmp traps to get instant notifications."}),`
`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:"language-#!/bin/bash",children:`
# Bash script to check the status of a SRX cluster.
#  Works by SSHing into cluster to check "show chassis cluster status" command and SNMP walking to make sure BGP peers
#  are both in a connected state

STATE_OK=0
STATE_WARNING=1
STATE_CRITICAL=2
STATE_UNKNOWN=3

clusterAddress=$1
privateKey=$2
clusterStatus=\`ssh nagios@$clusterAddress -i $privateKey "show chassis cluster status"\`

declare -i primaryCount
declare -i secondaryCount
declare -i failoverCount
declare -i activeBgpPeers

activeBgpPeers=\`snmpwalk -Os -c public -v 1 $clusterAddress .1.3.6.1.2.1.15.3.1.2 | grep "INTEGER: 6" | wc -l\`
primaryCount=\`echo "$clusterStatus" | grep primary | wc -l\`
secondaryCount=\`echo "$clusterStatus" | grep secondary | wc -l\`
failoverCount=\`echo "$clusterStatus" | grep "Failover count: 0" | wc -l\`

if [ $primaryCount -ne 2 ]
then
  echo "No two primary redundancy groups"
  echo "$clusterStatus"
  exit $STATE_CRITICAL
fi

if [ $secondaryCount -ne 2 ]
then
  echo "No two secondary redundancy groups"
  echo "$clusterStatus"
  exit $STATE_CRITICAL
fi

if [ $failoverCount -ne 2 ]
then
  echo "SRX has fallen over on a redundancy group"
  echo "$clusterStatus"
  exit $STATE_WARNING
fi

if [ $activeBgpPeers -ne 2 ]
then
  echo "NOT 2 Active BGP Peers"
  exit $STATE_CRITICAL
fi

echo "OK, 2 peers.  OK: Chassis Cluster status OK"
echo "$clusterStatus"
exit $STATE_OK
`})}),`
`,(0,n.jsx)(e.p,{children:"\xA0"})]})}function y(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(h,t)})):h(t)}var $=y;return T(v);})();
;return Component;f:["$","article",null,{"className":"","children":["$","div",null,{"className":"__className_12746b mb-9","children":[["$","h2",null,{"className":"__className_df02b7 text-2xl","children":"Monitoring SRX Chassis Cluster"}],["$","div",null,{"className":"text-xs text-gray-400 italic mb-5","children":["Created: ",["$","$L10",null,{"date":"$D2012-07-09T04:44:35.000Z"}]]}],"$undefined",["$","div",null,{"className":"prose lg:prose-lg","children":["$","$L11",null,{"code":"$12"}]}]]}]}]
